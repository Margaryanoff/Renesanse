{"version":3,"file":"render.js","names":["render","renderParameters","rootComponent","firstRender","setInContext","then","element","rootComponentProps","rest","renderReactElementTree","React","createElement","getReactContainerElement","clearInContext","to","isServerSideLoaded","isServerSideRendered","hydrate","getFromContext","firstChild","removeChild","reactRender","getGlobalVariable","name","variable","window","undefined","document","getElementById","body","Error","setAttribute","appendChild"],"sources":["../../lib/client/render.js"],"sourcesContent":["import React from 'react'\r\n\r\nimport { setInContext, clearInContext, getFromContext } from '../context.js'\r\n\r\nimport reactRender, { hydrate } from './reactRender.js'\r\n\r\nimport { isServerSideLoaded, isServerSideRendered } from './flags.js'\r\n\r\n// Performs client-side React application rendering.\r\n// Takes `render()` function which renders the actual page.\r\n// Then this rendered page is rendered in a `rootComponent`\r\n// (e.g. Redux state `<Connector/>` and such).\r\n// This function is not exported and is not called directly in an application:\r\n// instead specific implementations call this function\r\n// providing their own `render()` logic\r\n// (e.g. Redux + React-router, React-router).\r\n//\r\nexport default function render({ render, renderParameters = {}, rootComponent }) {\r\n\tlet firstRender = true\r\n\t// Renders current React page (inside a `rootComponent`).\r\n\t// Returns a Promise for an object holding\r\n\t// `render` function for development mode hot reload,\r\n\t// and also `store` (if Redux is used).\r\n\tif (firstRender) {\r\n\t\tfirstRender = false\r\n\t} else {\r\n\t\tsetInContext('Page/HotReloadInProgress', true)\r\n\t}\r\n\treturn render(renderParameters).then(({ element, rootComponentProps, ...rest }) => {\r\n\t\t// if (locale) {\r\n\t\t// \trootComponentProps.locale = locale\r\n\t\t// }\r\n\t\trenderReactElementTree(\r\n\t\t\t// Render page `element` inside a `rootComponent` element.\r\n\t\t\t// E.g. Redux context `<Provider/>`, and others.\r\n\t\t\tReact.createElement(rootComponent, rootComponentProps, element),\r\n\t\t\t// DOM element to which React markup will be rendered\r\n\t\t\tgetReactContainerElement()\r\n\t\t)\r\n\t\tsetInContext('App/HasBeenRendered', true)\r\n\t\tif (!firstRender) {\r\n\t\t\tclearInContext('Page/HotReloadInProgress')\r\n\t\t}\r\n\t\treturn rest\r\n\t})\r\n}\r\n\r\nfunction renderReactElementTree(element, to) {\r\n\t// If using React >= 16 and the content is Server-Side Rendered.\r\n\tif (isServerSideLoaded() && isServerSideRendered()) {\r\n\t\t// An API introduced in React 16\r\n\t\t// for \"hydrating\" Server-Side Rendered markup.\r\n\t\t// https://reactjs.org/docs/react-dom.html#hydrate\r\n\t\thydrate(element, to)\r\n\t\treturn\r\n\t}\r\n\t// Clears `element` to prevent React warning:\r\n\t// \"Calling ReactDOM.render() to hydrate server-rendered markup\r\n\t//  will stop working in React v17. Replace the ReactDOM.render() call\r\n\t//  with ReactDOM.hydrate() if you want React to attach to the server HTML.\"\r\n\tif (!getFromContext('Page/HotReloadInProgress')) {\r\n\t\twhile (to.firstChild) {\r\n\t\t\tto.removeChild(to.firstChild)\r\n\t\t}\r\n\t}\r\n\treactRender(element, to)\r\n}\r\n\r\n// Retrieves a variable from `window` erasing it.\r\nfunction getGlobalVariable(name) {\r\n\tconst variable = window[name]\r\n\tif (variable !== undefined) {\r\n\t\tdelete window[name]\r\n\t}\r\n\treturn variable\r\n}\r\n\r\nfunction getReactContainerElement()\r\n{\r\n\tlet element = document.getElementById('react')\r\n\r\n\tif (!element) {\r\n\t\tconst body = document.body\r\n\t\tif (!body) {\r\n\t\t\tthrow new Error('<body/> tag not found, make sure this script is added to the end of <body/> rather than inside <head/>.')\r\n\t\t}\r\n\t\telement = document.createElement('div')\r\n\t\telement.setAttribute('id', 'react')\r\n\t\tbody.appendChild(element)\r\n\t}\r\n\r\n\treturn element\r\n}"],"mappings":";;;;;;;AAAA;AAEA;AAEA;AAEA;AAAqE;AAAA;AAAA;AAAA;AAAA;AAAA;AAErE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,MAAM,OAAmD;EAAA,IAAhDA,MAAM,QAANA,MAAM;IAAA,6BAAEC,gBAAgB;IAAhBA,gBAAgB,sCAAG,CAAC,CAAC;IAAEC,aAAa,QAAbA,aAAa;EAC5E,IAAIC,WAAW,GAAG,IAAI;EACtB;EACA;EACA;EACA;EACA,IAAIA,WAAW,EAAE;IAChBA,WAAW,GAAG,KAAK;EACpB,CAAC,MAAM;IACN,IAAAC,qBAAY,EAAC,0BAA0B,EAAE,IAAI,CAAC;EAC/C;EACA,OAAOJ,MAAM,CAACC,gBAAgB,CAAC,CAACI,IAAI,CAAC,iBAA8C;IAAA,IAA3CC,OAAO,SAAPA,OAAO;MAAEC,kBAAkB,SAAlBA,kBAAkB;MAAKC,IAAI;IAC3E;IACA;IACA;IACAC,sBAAsB;IACrB;IACA;IACAC,iBAAK,CAACC,aAAa,CAACT,aAAa,EAAEK,kBAAkB,EAAED,OAAO,CAAC;IAC/D;IACAM,wBAAwB,EAAE,CAC1B;IACD,IAAAR,qBAAY,EAAC,qBAAqB,EAAE,IAAI,CAAC;IACzC,IAAI,CAACD,WAAW,EAAE;MACjB,IAAAU,uBAAc,EAAC,0BAA0B,CAAC;IAC3C;IACA,OAAOL,IAAI;EACZ,CAAC,CAAC;AACH;AAEA,SAASC,sBAAsB,CAACH,OAAO,EAAEQ,EAAE,EAAE;EAC5C;EACA,IAAI,IAAAC,yBAAkB,GAAE,IAAI,IAAAC,2BAAoB,GAAE,EAAE;IACnD;IACA;IACA;IACA,IAAAC,oBAAO,EAACX,OAAO,EAAEQ,EAAE,CAAC;IACpB;EACD;EACA;EACA;EACA;EACA;EACA,IAAI,CAAC,IAAAI,uBAAc,EAAC,0BAA0B,CAAC,EAAE;IAChD,OAAOJ,EAAE,CAACK,UAAU,EAAE;MACrBL,EAAE,CAACM,WAAW,CAACN,EAAE,CAACK,UAAU,CAAC;IAC9B;EACD;EACA,IAAAE,uBAAW,EAACf,OAAO,EAAEQ,EAAE,CAAC;AACzB;;AAEA;AACA,SAASQ,iBAAiB,CAACC,IAAI,EAAE;EAChC,IAAMC,QAAQ,GAAGC,MAAM,CAACF,IAAI,CAAC;EAC7B,IAAIC,QAAQ,KAAKE,SAAS,EAAE;IAC3B,OAAOD,MAAM,CAACF,IAAI,CAAC;EACpB;EACA,OAAOC,QAAQ;AAChB;AAEA,SAASZ,wBAAwB,GACjC;EACC,IAAIN,OAAO,GAAGqB,QAAQ,CAACC,cAAc,CAAC,OAAO,CAAC;EAE9C,IAAI,CAACtB,OAAO,EAAE;IACb,IAAMuB,IAAI,GAAGF,QAAQ,CAACE,IAAI;IAC1B,IAAI,CAACA,IAAI,EAAE;MACV,MAAM,IAAIC,KAAK,CAAC,yGAAyG,CAAC;IAC3H;IACAxB,OAAO,GAAGqB,QAAQ,CAAChB,aAAa,CAAC,KAAK,CAAC;IACvCL,OAAO,CAACyB,YAAY,CAAC,IAAI,EAAE,OAAO,CAAC;IACnCF,IAAI,CAACG,WAAW,CAAC1B,OAAO,CAAC;EAC1B;EAEA,OAAOA,OAAO;AACf"}