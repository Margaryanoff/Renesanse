{"version":3,"file":"MetaUpdater.js","names":["MetaUpdater","meta","stash","routePosition","props","customProps","newMeta","useSelector","getter","usePageStateSelector","reducerName","usePageStateSelectorWithCustomUseSelector","dropUndefinedProperties","getFromContext","prevMeta","getRootRouteComponentMeta","getPageRouteComponentMeta","Error","isEqual","applyMeta","mergeMeta","rootMetaData","pageMetaData","console","log"],"sources":["../../../lib/redux/meta/MetaUpdater.js"],"sourcesContent":["import React from 'react'\r\n// import PropTypes from 'prop-types'\r\n\r\nimport { useSelector } from 'react-redux'\r\n\r\n// import { isEqual } from 'lodash-es'\r\nimport isEqual from 'lodash/isEqual.js'\r\n\r\nimport { usePageStateSelectorWithCustomUseSelector } from '../usePageStateSelector.js'\r\n\r\nimport mergeMeta from '../../meta/mergeMeta.js'\r\nimport applyMeta from '../../meta/applyMeta.js'\r\nimport dropUndefinedProperties from '../../meta/dropUndefinedProperties.js'\r\nimport { getFromContext } from '../../context.js'\r\n\r\nexport default function MetaUpdater({\r\n\tmeta,\r\n\tstash,\r\n\troutePosition,\r\n\tprops,\r\n\tcustomProps\r\n}) {\r\n\t// `meta()` function uses `useSelector()` hook,\r\n\r\n\t// Calculate `newMeta` even if `InitialMetaHasBeenApplied` flag is `false`,\r\n\t// so that it calls the `useSelector()` hook which will trigger a rerender later\r\n\t// when the value returned by that `useSelector()` hook changes.\r\n\tlet newMeta = meta({\r\n\t\tuseSelector: getter => useSelector(getter),\r\n\t\tusePageStateSelector: (reducerName, getter) => usePageStateSelectorWithCustomUseSelector(reducerName, getter, useSelector),\r\n\t\tprops: {\r\n\t\t\t...props,\r\n\t\t\t...customProps\r\n\t\t}\r\n\t})\r\n\r\n\tif (newMeta) {\r\n\t\tnewMeta = dropUndefinedProperties(newMeta)\r\n\t}\r\n\r\n\tif (getFromContext('App/InitialMetaHasBeenApplied')) {\r\n\t\tlet prevMeta\r\n\t\tswitch (routePosition) {\r\n\t\t\tcase 'root':\r\n\t\t\t\tprevMeta = stash.getRootRouteComponentMeta()\r\n\t\t\t\tbreak\r\n\t\t\tcase 'leaf':\r\n\t\t\t\tprevMeta = stash.getPageRouteComponentMeta()\r\n\t\t\t\tbreak\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error(`[react-pages] Unsupported route position: \"${routePosition}\"`)\r\n\t\t}\r\n\r\n\t\tif (!isEqual(prevMeta, newMeta)) {\r\n\t\t\tswitch (routePosition) {\r\n\t\t\t\tcase 'root':\r\n\t\t\t\t\tapplyMeta(mergeMeta({\r\n\t\t\t\t\t\trootMetaData: newMeta,\r\n\t\t\t\t\t\tpageMetaData: stash.getPageRouteComponentMeta(),\r\n\t\t\t\t\t\tstash\r\n\t\t\t\t\t}))\r\n\t\t\t\t\tconsole.log('[react-pages] Root <meta/> updated')\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase 'leaf':\r\n\t\t\t\t\tapplyMeta(mergeMeta({\r\n\t\t\t\t\t\trootMetaData: stash.getRootRouteComponentMeta(),\r\n\t\t\t\t\t\tpageMetaData: newMeta,\r\n\t\t\t\t\t\tstash\r\n\t\t\t\t\t}))\r\n\t\t\t\t\tconsole.log('[react-pages] Page <meta/> updated')\r\n\t\t\t\t\tbreak\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error(`[react-pages] Unsupported route position: \"${routePosition}\"`)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn null\r\n}\r\n\r\n// MetaUpdater.propTypes = {\r\n// \tmeta: PropTypes.func.isRequired,\r\n// \tstash: PropTypes.object.isRequired,\r\n// \troutePosition: PropTypes.oneOf(['root', 'leaf']).isRequired,\r\n// \tprops: PropTypes.object,\r\n// \tcustomProps: PropTypes.object\r\n// }\r\n"],"mappings":";;;;;;AAAA;AAGA;AAGA;AAEA;AAEA;AACA;AACA;AACA;AAAiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAElC,SAASA,WAAW,OAMhC;EAAA,IALFC,IAAI,QAAJA,IAAI;IACJC,KAAK,QAALA,KAAK;IACLC,aAAa,QAAbA,aAAa;IACbC,KAAK,QAALA,KAAK;IACLC,WAAW,QAAXA,WAAW;EAEX;;EAEA;EACA;EACA;EACA,IAAIC,OAAO,GAAGL,IAAI,CAAC;IAClBM,WAAW,EAAE,qBAAAC,MAAM;MAAA,OAAI,IAAAD,uBAAW,EAACC,MAAM,CAAC;IAAA;IAC1CC,oBAAoB,EAAE,8BAACC,WAAW,EAAEF,MAAM;MAAA,OAAK,IAAAG,+DAAyC,EAACD,WAAW,EAAEF,MAAM,EAAED,uBAAW,CAAC;IAAA;IAC1HH,KAAK,kCACDA,KAAK,GACLC,WAAW;EAEhB,CAAC,CAAC;EAEF,IAAIC,OAAO,EAAE;IACZA,OAAO,GAAG,IAAAM,mCAAuB,EAACN,OAAO,CAAC;EAC3C;EAEA,IAAI,IAAAO,uBAAc,EAAC,+BAA+B,CAAC,EAAE;IACpD,IAAIC,QAAQ;IACZ,QAAQX,aAAa;MACpB,KAAK,MAAM;QACVW,QAAQ,GAAGZ,KAAK,CAACa,yBAAyB,EAAE;QAC5C;MACD,KAAK,MAAM;QACVD,QAAQ,GAAGZ,KAAK,CAACc,yBAAyB,EAAE;QAC5C;MACD;QACC,MAAM,IAAIC,KAAK,uDAA+Cd,aAAa,QAAI;IAAA;IAGjF,IAAI,CAAC,IAAAe,mBAAO,EAACJ,QAAQ,EAAER,OAAO,CAAC,EAAE;MAChC,QAAQH,aAAa;QACpB,KAAK,MAAM;UACV,IAAAgB,qBAAS,EAAC,IAAAC,qBAAS,EAAC;YACnBC,YAAY,EAAEf,OAAO;YACrBgB,YAAY,EAAEpB,KAAK,CAACc,yBAAyB,EAAE;YAC/Cd,KAAK,EAALA;UACD,CAAC,CAAC,CAAC;UACHqB,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;UACjD;QACD,KAAK,MAAM;UACV,IAAAL,qBAAS,EAAC,IAAAC,qBAAS,EAAC;YACnBC,YAAY,EAAEnB,KAAK,CAACa,yBAAyB,EAAE;YAC/CO,YAAY,EAAEhB,OAAO;YACrBJ,KAAK,EAALA;UACD,CAAC,CAAC,CAAC;UACHqB,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;UACjD;QACD;UACC,MAAM,IAAIP,KAAK,uDAA+Cd,aAAa,QAAI;MAAA;IAElF;EACD;EAEA,OAAO,IAAI;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA"}