{"version":3,"file":"createGetDataFunctionsForRoutes.js","names":["createGetDataFunctionsForRoutes","routes","stash","codeSplit","server","onLoadError","getLocale","getCookie","customContext","context","getLoadFunction","route","load","Component","getData","createGetDataFunction","routePosition","onError","forEachLeafRoute","leafRoute","defer","parameters","params","dispatch","getState","action","origin"],"sources":["../../lib/redux/createGetDataFunctionsForRoutes.js"],"sourcesContent":["import getData from './load/getData.js'\r\n\r\nimport forEachLeafRoute from '../router/forEachLeafRoute.js'\r\n\r\nexport default function createGetDataFunctionsForRoutes(routes, {\r\n\tstash,\r\n\tcodeSplit,\r\n\tserver,\r\n\tonLoadError,\r\n\tgetLocale,\r\n\tgetCookie,\r\n\tcontext: customContext\r\n}) {\r\n\tconst getLoadFunction = (route) => codeSplit ? route.load : route.Component.load\r\n\r\n\t// Set `getData` function on the root route's `Component`.\r\n\t// https://4catalyzer.github.io/found/docs/configuration/route-config#data-or-getdata\r\n\tif (getLoadFunction(routes[0])) {\r\n\t\troutes[0].getData = createGetDataFunction({\r\n\t\t\troutePosition: 'root',\r\n\t\t\troutes,\r\n\t\t\tcodeSplit,\r\n\t\t\tserver,\r\n\t\t\tonError: onLoadError,\r\n\t\t\tgetLocale,\r\n\t\t\tgetCookie,\r\n\t\t\tcontext: customContext,\r\n\t\t\tstash\r\n\t\t})\r\n\t}\r\n\r\n\t// Set `getData` function on the \"leaf\" route `Component`s.\r\n\t// https://4catalyzer.github.io/found/docs/configuration/route-config#data-or-getdata\r\n\r\n\tforEachLeafRoute(routes, (leafRoute) => {\r\n\t\tif (getLoadFunction(leafRoute)) {\r\n\t\t\tleafRoute.getData = createGetDataFunction({\r\n\t\t\t\troutePosition: 'leaf',\r\n\t\t\t\troutes,\r\n\t\t\t\tcodeSplit,\r\n\t\t\t\tserver,\r\n\t\t\t\tonError: onLoadError,\r\n\t\t\t\tgetLocale,\r\n\t\t\t\tgetCookie,\r\n\t\t\t\tcontext: customContext,\r\n\t\t\t\tstash\r\n\t\t\t})\r\n\r\n\t\t\t// `defer: true` instructs `getData` of this route and all of its descendants\r\n\t\t\t// to wait for all parent route `getData` promises.\r\n\t\t\t//\r\n\t\t\t// \"Setting defer on a route will make the resolver defer calling its\r\n\t\t\t//  getData method and the getData methods on all of its descendants until\r\n\t\t\t//  all of its parent data promises have resolved.\"\r\n\t\t\t//\r\n\t\t\t// https://4catalyzer.github.io/found/docs/configuration/route-config\r\n\t\t\tleafRoute.defer = true\r\n\t\t}\r\n\t})\r\n}\r\n\r\nfunction createGetDataFunction(parameters) {\r\n\t// The `context` parameter is the `matchContext` parameter that's passed in `./lib/router/index.js`.\r\n\t// https://4catalyzer.github.io/found/docs/configuration/route-config#data-or-getdata\r\n\treturn function({ params, context: { dispatch, getState } }) {\r\n\t\treturn getData({\r\n\t\t\t...parameters,\r\n\t\t\tparams,\r\n\t\t\tdispatch: (action) => {\r\n\t\t\t\t// This `if` prevents an error message in console:\r\n\t\t\t\t// \"Error: Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.\".\r\n\t\t\t\t// That error message was appearing when `{origin: 'load'}` action was dispatched\r\n\t\t\t\t// as a result of someone accidentally calling `dispatch()` with no action argument.\r\n\t\t\t\tif (action) {\r\n\t\t\t\t\taction = {\r\n\t\t\t\t\t\t...action,\r\n\t\t\t\t\t\t// The `origin: \"load\"` parameter is used in `middleware/asynchronous.js`\r\n\t\t\t\t\t\t// to detect HTTP calls originating from `load()` functions.\r\n\t\t\t\t\t\torigin: 'load'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn dispatch(action)\r\n\t\t\t},\r\n\t\t\tgetState\r\n\t\t})\r\n\t}\r\n}"],"mappings":";;;;;;AAAA;AAEA;AAA4D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAE7C,SAASA,+BAA+B,CAACC,MAAM,QAQ3D;EAAA,IAPFC,KAAK,QAALA,KAAK;IACLC,SAAS,QAATA,SAAS;IACTC,MAAM,QAANA,MAAM;IACNC,WAAW,QAAXA,WAAW;IACXC,SAAS,QAATA,SAAS;IACTC,SAAS,QAATA,SAAS;IACAC,aAAa,QAAtBC,OAAO;EAEP,IAAMC,eAAe,GAAG,SAAlBA,eAAe,CAAIC,KAAK;IAAA,OAAKR,SAAS,GAAGQ,KAAK,CAACC,IAAI,GAAGD,KAAK,CAACE,SAAS,CAACD,IAAI;EAAA;;EAEhF;EACA;EACA,IAAIF,eAAe,CAACT,MAAM,CAAC,CAAC,CAAC,CAAC,EAAE;IAC/BA,MAAM,CAAC,CAAC,CAAC,CAACa,OAAO,GAAGC,qBAAqB,CAAC;MACzCC,aAAa,EAAE,MAAM;MACrBf,MAAM,EAANA,MAAM;MACNE,SAAS,EAATA,SAAS;MACTC,MAAM,EAANA,MAAM;MACNa,OAAO,EAAEZ,WAAW;MACpBC,SAAS,EAATA,SAAS;MACTC,SAAS,EAATA,SAAS;MACTE,OAAO,EAAED,aAAa;MACtBN,KAAK,EAALA;IACD,CAAC,CAAC;EACH;;EAEA;EACA;;EAEA,IAAAgB,4BAAgB,EAACjB,MAAM,EAAE,UAACkB,SAAS,EAAK;IACvC,IAAIT,eAAe,CAACS,SAAS,CAAC,EAAE;MAC/BA,SAAS,CAACL,OAAO,GAAGC,qBAAqB,CAAC;QACzCC,aAAa,EAAE,MAAM;QACrBf,MAAM,EAANA,MAAM;QACNE,SAAS,EAATA,SAAS;QACTC,MAAM,EAANA,MAAM;QACNa,OAAO,EAAEZ,WAAW;QACpBC,SAAS,EAATA,SAAS;QACTC,SAAS,EAATA,SAAS;QACTE,OAAO,EAAED,aAAa;QACtBN,KAAK,EAALA;MACD,CAAC,CAAC;;MAEF;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAiB,SAAS,CAACC,KAAK,GAAG,IAAI;IACvB;EACD,CAAC,CAAC;AACH;AAEA,SAASL,qBAAqB,CAACM,UAAU,EAAE;EAC1C;EACA;EACA,OAAO,iBAAsD;IAAA,IAA3CC,MAAM,SAANA,MAAM;MAAA,sBAAEb,OAAO;MAAIc,SAAQ,iBAARA,QAAQ;MAAEC,QAAQ,iBAARA,QAAQ;IACtD,OAAO,IAAAV,mBAAO,kCACVO,UAAU;MACbC,MAAM,EAANA,MAAM;MACNC,QAAQ,EAAE,kBAACE,MAAM,EAAK;QACrB;QACA;QACA;QACA;QACA,IAAIA,MAAM,EAAE;UACXA,MAAM,mCACFA,MAAM;YACT;YACA;YACAC,MAAM,EAAE;UAAM,EACd;QACF;QACA,OAAOH,SAAQ,CAACE,MAAM,CAAC;MACxB,CAAC;MACDD,QAAQ,EAARA;IAAQ,GACP;EACH,CAAC;AACF"}