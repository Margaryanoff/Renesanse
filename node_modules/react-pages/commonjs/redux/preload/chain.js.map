{"version":3,"file":"chain.js","names":["_flags","require","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","iterator","constructor","prototype","_createForOfIteratorHelper","o","allowArrayLike","it","Array","isArray","_unsupportedIterableToArray","F","s","n","done","e","_e","f","normalCompletion","didErr","err","step","next","_e2","minLen","_arrayLikeToArray","toString","slice","name","from","test","arr","len","arr2","generatePreloadChain","preloaders","server","isInitialClientSidePreload","getState","dispatch","location","params","history","getCookie","preloading","setUpPreloaders","filter_preloaders","chain","chain_preloaders","promisify","preload_arguments","_iterator","_step","component_preloaders","_iterator2","_step2","preloader","setUpPreloader","preload","isServerSidePreloaded","options","client","_","parallel","concat","is_preloader_blocking","get_preloader","_iterator3","_step3","sibling_preloader","blocking","blockingSibling","Promise","all","map","link","then","results","reduce","combined","result","promise","cancelled","nextResult","resolve","array","part"],"sources":["../../../lib/redux/preload/chain.js"],"sourcesContent":["import { isServerSidePreloaded } from '../../client/flags.js'\r\n\r\n// Returns function returning a Promise\r\n// which resolves when all the required page `load`s are resolved.\r\n//\r\n// If no preloading is needed, then returns nothing.\r\n//\r\nexport default function generatePreloadChain\r\n(\r\n\tpreloaders,\r\n\tserver,\r\n\tisInitialClientSidePreload,\r\n\tgetState,\r\n\tdispatch,\r\n\tlocation,\r\n\tparams,\r\n\thistory,\r\n\tgetCookie,\r\n\tpreloading\r\n)\r\n{\r\n\t// Set `.preload({ ... })` function arguments,\r\n\t// and also set default `load` options.\r\n\tsetUpPreloaders(\r\n\t\tpreloaders,\r\n\t\t{\r\n\t\t\tdispatch,\r\n\t\t\tgetState,\r\n\t\t\tlocation,\r\n\t\t\tparams,\r\n\t\t\thistory,\r\n\t\t\tserver,\r\n\t\t\t// `getCookie` `load` parameter has been requested:\r\n\t\t\t// https://github.com/catamphetamine/react-website/issues/71\r\n\t\t\tgetCookie\r\n\t\t},\r\n\t\tserver\r\n\t)\r\n\r\n\t// Only select those `load`s which\r\n\t// should be run in current circumstances.\r\n\tpreloaders = filter_preloaders(preloaders, server, isInitialClientSidePreload)\r\n\r\n\t// Construct a sequential chain out of preloaders.\r\n\t// Because each of them could be either parallel or sequential.\r\n\tconst chain = chain_preloaders(preloaders)\r\n\r\n\t// If there are no `load`s for this route, then exit.\r\n\tif (chain.length === 0) {\r\n\t\treturn\r\n\t}\r\n\r\n\t// Return a function which generates preloading `Promise` chain.\r\n\treturn () => promisify(chain, preloading)\r\n}\r\n\r\n// Applies default `load` options\r\n// and sets `load` function arguments.\r\nfunction setUpPreloaders(preloaders, preload_arguments, server)\r\n{\r\n\tfor (const component_preloaders of preloaders) {\r\n\t\tfor (const preloader of component_preloaders) {\r\n\t\t\tsetUpPreloader(preloader, preload_arguments, server)\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Applies default `load` options\r\n// and sets `load` function arguments.\r\nfunction setUpPreloader(preloader, preload_arguments, server)\r\n{\r\n\tconst preload = preloader.preload\r\n\tpreloader.preload = () => preload(preload_arguments)\r\n\r\n\t// If Server-Side Rendering is not being used at all\r\n\t// then all `load`s must be marked as client-side ones.\r\n\tif (!server && !isServerSidePreloaded()) {\r\n\t\tpreloader.options.client = true\r\n\t}\r\n}\r\n\r\n// Selects only those `load`s which\r\n// should be run in current circumstances.\r\nexport function filter_preloaders(preloaders, server, isInitialClientSidePreload)\r\n{\r\n\t// `preloaders` array will be mutated\r\n\tpreloaders = preloaders.slice()\r\n\r\n\tpreloaders.forEach((_, i) =>\r\n\t{\r\n\t\tpreloaders[i] = preloaders[i].filter((preloader) =>\r\n\t\t{\r\n\t\t\t// Don't execute client-side-only `load`s on server side\r\n\t\t\tif (preloader.options.client && server) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\t// Don't execute server-side-only `load`s on client side\r\n\t\t\tif (preloader.options.server && !server) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\t// If it's initial client side preload (after the page has been loaded),\r\n\t\t\t// then only execute those `load`s marked as \"client-side-only\".\r\n\t\t\tif (isInitialClientSidePreload && !preloader.options.client) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t})\r\n\t})\r\n\r\n\treturn preloaders.filter(component_preloaders => component_preloaders.length > 0)\r\n}\r\n\r\n// Constructs `preload` chain.\r\n//\r\n// @param `preloaders` is an array of `component_preloaders`.\r\n// `component_preloaders` is an array of all\r\n// `load`s for a particular React component.\r\n// Therefore `preloaders` is an array of arrays.\r\nexport function chain_preloaders(preloaders, chain = [], parallel = [])\r\n{\r\n\t// If all `preload`s have been visited\r\n\tif (preloaders.length === 0)\r\n\t{\r\n\t\tif (parallel.length === 0) {\r\n\t\t\treturn chain\r\n\t\t}\r\n\t\t// Finalize pending parallel `preload`s\r\n\t\tif (parallel.length === 1) {\r\n\t\t\treturn chain.concat(parallel)\r\n\t\t}\r\n\t\treturn chain.concat({ parallel })\r\n\t}\r\n\r\n\t// `component_preloaders` is an array of all\r\n\t// `load`s for a particular React component.\r\n\tconst preloader = preloaders[0]\r\n\tpreloaders = preloaders.slice(1)\r\n\r\n\tif (!is_preloader_blocking(preloader))\r\n\t{\r\n\t\treturn chain_preloaders(\r\n\t\t\tpreloaders,\r\n\t\t\tchain,\r\n\t\t\tconcat(parallel, get_preloader(preloader))\r\n\t\t)\r\n\t}\r\n\r\n\tif (parallel.length === 0)\r\n\t{\r\n\t\treturn chain_preloaders(\r\n\t\t\tpreloaders,\r\n\t\t\tconcat(chain, get_preloader(preloader)),\r\n\t\t\t[]\r\n\t\t)\r\n\t}\r\n\r\n\treturn chain_preloaders(\r\n\t\tpreloaders,\r\n\t\tchain.concat({ parallel: concat(parallel, get_preloader(preloader)) }),\r\n\t\t[]\r\n\t)\r\n}\r\n\r\nfunction get_preloader(preloader)\r\n{\r\n\t// A list of same component's `load`s\r\n\tif (Array.isArray(preloader)) {\r\n\t\treturn chain_preloaders(preloader)\r\n\t}\r\n\r\n\t// Same component adjacent `load`\r\n\treturn preloader.preload\r\n}\r\n\r\nfunction is_preloader_blocking(preloader)\r\n{\r\n\t// A list of same component's `load`s\r\n\tif (Array.isArray(preloader))\r\n\t{\r\n\t\t// Determine the proper `blocking` option\r\n\t\t// for this component's `load`s.\r\n\t\tfor (const sibling_preloader of preloader)\r\n\t\t{\r\n\t\t\t// If any of component's `load`s are `blocking: true`\r\n\t\t\t// then all of them are `blocking: true`.\r\n\t\t\tif (sibling_preloader.options.blocking)\r\n\t\t\t{\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false\r\n\t}\r\n\r\n\t// Same component adjacent `load`\r\n\treturn preloader.options.blockingSibling\r\n}\r\n\r\n// Returns a `Promise` chain.\r\nexport function promisify(chain, preloading)\r\n{\r\n\tif (typeof chain === 'function') {\r\n\t\treturn chain()\r\n\t}\r\n\r\n\tif (typeof chain === 'object' && chain.parallel)\r\n\t{\r\n\t\treturn Promise.all(chain.parallel.map(link => promisify(link, preloading)))\r\n\t\t\t.then((results) => {\r\n\t\t\t\treturn results.reduce((combined, result) => ({\r\n\t\t\t\t\t...combined,\r\n\t\t\t\t\t...result\r\n\t\t\t\t}), {})\r\n\t\t\t})\r\n\t}\r\n\r\n\treturn chain.reduce((promise, link) =>\r\n\t{\r\n\t\treturn promise.then((result) =>\r\n\t\t{\r\n\t\t\tif (preloading.cancelled) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\treturn promisify(link, preloading).then((nextResult) => ({\r\n\t\t\t\t...result,\r\n\t\t\t\t...nextResult\r\n\t\t\t}))\r\n\t\t})\r\n\t},\r\n\tPromise.resolve())\r\n}\r\n\r\nfunction concat(array, part)\r\n{\r\n\tif (Array.isArray(part) && part.length > 1) {\r\n\t\t// Pushes an array\r\n\t\treturn array.concat([part])\r\n\t}\r\n\t// Pushes a single element\r\n\treturn array.concat(part)\r\n}"],"mappings":"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"}