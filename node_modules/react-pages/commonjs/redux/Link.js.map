{"version":3,"file":"Link.js","names":["BaseLink","ref","Component","as","to","match","navigationContext","activeClassName","activeStyle","activePropName","router","exact","props","isObject","Error","onClick","target","onClick_","useCallback","event","defaultPrevented","metaKey","altKey","ctrlKey","shiftKey","button","preventDefault","setNavigationContext","push","href","createHref","childrenIsFunction","children","toLocation","createLocation","active","isActive","className","style","React","createElement","forwardRef","propTypes","PropTypes","elementType","isRequired","oneOfType","string","object","any","bool","func","node","defaultProps","Link_","withRouter","displayName","ExternalLink","rest","Link","instantBack","onClickHandler","setInstantBackAbilityFlagForThisNavigation","isRelative","isRelativeUrl","isRelativeLocation","url","location"],"sources":["../../lib/redux/Link.js"],"sourcesContent":["import React, { useCallback } from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\n// `@catamphetamine/found` is a fork of `found` with some changes:\r\n// * `redux` and `react-redux` are `peerDependencies` instead of `dependencies`.\r\n// * `farce` was replaced with `@catamphetamine/farce`.\r\n// * Fixed a bug when `found` ignores all navigation actions until its `componentDidMount()` is called.\r\nimport { withRouter } from '@catamphetamine/found'\r\n\r\nimport { setInstantBackAbilityFlagForThisNavigation } from './client/instantNavigation.js'\r\nimport { setNavigationContext } from '../router/actions.js'\r\nimport isObject from '../isObject.js'\r\n\r\n// `found`'s `src/BaseLink.js` doesn't have a `.focus()` method\r\n// and doesn't forward `ref` which prevents it from being\r\n// focusable programmatically.\r\n//\r\n//https://github.com/4Catalyzer/found/blob/master/src/Link.js\r\n// https://github.com/4Catalyzer/found/blob/master/src/BaseLink.js\r\n//\r\n// Therefore, copy-pasted it here and added `React.forwardRef()`.\r\n//\r\nfunction BaseLink({\r\n  as: Component,\r\n  to,\r\n  match,\r\n  navigationContext,\r\n  activeClassName,\r\n  activeStyle,\r\n  activePropName,\r\n  router,\r\n  exact,\r\n  ...props\r\n}, ref) {\r\n  if (!(typeof to === 'string') && !isObject(to)) {\r\n    throw new Error('[react-pages] `to` property (string or object) is required on a `<Link/>`')\r\n  }\r\n\r\n\tconst { onClick, target } = props\r\n\r\n  const onClick_ = useCallback((event) => {\r\n    if (onClick) {\r\n      onClick(event)\r\n    }\r\n\r\n    // Don't do anything if the user's onClick handler prevented default.\r\n    // Otherwise, let the browser handle the link with the computed href if the\r\n    // event wasn't an unmodified left click, or if the link has a target other\r\n    // than _self.\r\n    if (\r\n      event.defaultPrevented ||\r\n      event.metaKey ||\r\n      event.altKey ||\r\n      event.ctrlKey ||\r\n      event.shiftKey ||\r\n      event.button !== 0 ||\r\n      (target && target !== '_self')\r\n    ) {\r\n      return\r\n    }\r\n\r\n    event.preventDefault()\r\n\r\n    if (navigationContext) {\r\n      setNavigationContext(navigationContext)\r\n    }\r\n\r\n    // FIXME: When clicking on a link to the same location in the browser, the\r\n    // actual becomes a replace rather than a push. We may want the same\r\n    // handling â€“ perhaps implemented in the Farce protocol.\r\n    router.push(to)\r\n  }, [\r\n  \tonClick,\r\n  \ttarget,\r\n  \tto,\r\n  \trouter\r\n  ])\r\n\r\n  const href = router.createHref(to)\r\n  const childrenIsFunction = typeof props.children === 'function'\r\n\r\n  if (\r\n    childrenIsFunction ||\r\n    activeClassName ||\r\n    activeStyle ||\r\n    activePropName\r\n  ) {\r\n    const toLocation = router.createLocation(to)\r\n    const active = router.isActive(match, toLocation, { exact })\r\n\r\n    if (childrenIsFunction) {\r\n      return props.children({ href, active, onClick: this.onClick })\r\n    }\r\n\r\n    if (active) {\r\n      if (activeClassName) {\r\n        props.className = props.className\r\n          ? `${props.className} ${activeClassName}`\r\n          : activeClassName\r\n      }\r\n\r\n      if (activeStyle) {\r\n        props.style = { ...props.style, ...activeStyle }\r\n      }\r\n    }\r\n\r\n    if (activePropName) {\r\n      props[activePropName] = active\r\n    }\r\n  }\r\n\r\n  return React.createElement(Component, {\r\n    ref,\r\n    ...props,\r\n    href,\r\n    onClick: onClick_\r\n  })\r\n}\r\n\r\nBaseLink = React.forwardRef(BaseLink)\r\n\r\nBaseLink.propTypes = {\r\n  as: PropTypes.elementType.isRequired,\r\n  to: PropTypes.oneOfType([PropTypes.string, PropTypes.object]).isRequired,\r\n  match: PropTypes.object.isRequired,\r\n  activeClassName: PropTypes.string,\r\n  activeStyle: PropTypes.object,\r\n  activePropName: PropTypes.string,\r\n  navigationContext: PropTypes.any,\r\n  router: PropTypes.object.isRequired,\r\n  exact: PropTypes.bool.isRequired,\r\n  target: PropTypes.string,\r\n  onClick: PropTypes.func,\r\n  children: PropTypes.oneOfType([PropTypes.node, PropTypes.func])\r\n}\r\n\r\nBaseLink.defaultProps = {\r\n  as: 'a',\r\n  exact: false\r\n}\r\n\r\nconst Link_ = withRouter(BaseLink);\r\nLink_.displayName = 'Link';\r\n\r\nconst ExternalLink = React.forwardRef(({ to, ...rest }, ref) => {\r\n  return React.createElement('a', { ...rest, href: to, ref })\r\n})\r\n\r\nlet Link = function({\r\n\tinstantBack,\r\n\tonClick,\r\n  to,\r\n\t...rest\r\n}, ref) {\r\n\tconst onClickHandler = useCallback((event) => {\r\n\t\tif (onClick) {\r\n\t\t\tonClick(event)\r\n\t\t}\r\n\t\tif (event.defaultPrevented) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tsetInstantBackAbilityFlagForThisNavigation(instantBack)\r\n\t}, [\r\n\t\tinstantBack,\r\n\t\tonClick\r\n\t])\r\n\r\n  const isRelative = typeof to === 'string' ? isRelativeUrl(to) : isRelativeLocation(to)\r\n\r\n\treturn React.createElement(\r\n    isRelative ? Link_ : ExternalLink,\r\n    {\r\n      ref,\r\n      ...rest,\r\n      to,\r\n      onClick: onClickHandler\r\n    }\r\n\t)\r\n}\r\n\r\nLink = React.forwardRef(Link)\r\n\r\nLink.propTypes = {\r\n\tinstantBack: PropTypes.bool,\r\n\tonClick: PropTypes.func\r\n}\r\n\r\nexport default Link\r\n\r\nfunction isRelativeUrl(url) {\r\n  return url && url[0] === '/' && url[1] !== '/'\r\n}\r\n\r\nfunction isRelativeLocation(location) {\r\n  // return something like `location.origin === useLocation().origin`\r\n  return true\r\n}"],"mappings":"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"}