"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = useSelectorForPage;
var _react = require("react");
var _reactRedux = require("react-redux");
var _useNavigationLocation = _interopRequireDefault(require("./navigation/useNavigationLocation.js"));
var _useLocation = _interopRequireDefault(require("../router/useLocation.js"));
var _isSamePage = _interopRequireDefault(require("../isSamePage.js"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }
// `useSelectorForPage()` is a "safe" replacement for `useSelector()` hook
// that should be used to access page-specific data in Redux state.
// It guards against the situations when the user navigates from same page component
// to same page component, resulting in the page-specific state being corrupted
// during the transition period.
//
// The concept of a "page" is: a "page" is something within a certain pathname.
// I.e. changing URL query parameters or "hash" isn't considered "going to another page",
// even though the URL value in the address bar changes in those cases.
// Only changing URL query `pathname` is considered "going to another page".
//
// See the comments in `isSamePage.js` file for the rationale on defining a "page" that way.
//
function useSelectorForPage(selector) {
  // This is a fully-formed location object:
  // {
  //   "action": "POP",
  //   "origin": "http://localhost:1234",
  //   "protocol": "http:",
  //   "host": "localhost:1234",
  //   "hostname": "localhost",
  //   "port": "1234",
  //   "pathname": "/a",
  //   "search": "",
  //   "hash": "",
  //   "key": "wcyrb4:0",
  //   "index": 1,
  //   "delta": 0,
  //   "query": {}
  // }
  var location = (0, _useLocation["default"])();

  // `navigationLocation` object has the same shape as the `location` object above.
  var navigationLocation = (0, _useNavigationLocation["default"])();
  var value = (0, _reactRedux.useSelector)(selector);
  var latestValueForThisLocation = (0, _react.useRef)();
  if ((0, _isSamePage["default"])(location, navigationLocation)) {
    latestValueForThisLocation.current = value;
  }
  return latestValueForThisLocation.current;
}
//# sourceMappingURL=useSelectorForPage.js.map