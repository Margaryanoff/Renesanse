{"version":3,"file":"createRenderFunctionsForRoutes.js","names":["createRenderFunctionsForRoutes","routes","stash","codeSplit","server","getMetaFunction","route","meta","Component","getShouldPassMetaComponentProperty","metaComponentProperty","createRenderFunctionForRoute","routePosition","shouldPassMetaComponentProperty","props","rest","undefined","router","data","componentProps","redirect","redirectStatusCode","RedirectException","url","renderComponent","React","createElement","renderMetaUpdaterComponent","customProps","MetaUpdater","shouldUpdateMetaInRealTime","Meta","EmptyComponent","MetaUpdaterAndPageComponent","componentElement","metaUpdaterElement","render","forEachLeafRoute","leafRoute","forEachRoute","permanentRedirectTo","children","Fragment","cloneElement"],"sources":["../../lib/redux/createRenderFunctionsForRoutes.js"],"sourcesContent":["import React from 'react'\r\n\r\nimport { RedirectException } from '../router/index.js'\r\n// import getRoutePath from '../router/getRoutePath.js'\r\nimport forEachRoute from '../router/forEachRoute.js'\r\nimport forEachLeafRoute from '../router/forEachLeafRoute.js'\r\n\r\nimport MetaUpdater from './meta/MetaUpdater.js'\r\n\r\nexport default function createRenderFunctionsForRoutes(routes, {\r\n\tstash,\r\n\tcodeSplit,\r\n\tserver\r\n}) {\r\n\tconst getMetaFunction = (route) => codeSplit ? route.meta : route.Component.meta\r\n\tconst getShouldPassMetaComponentProperty = (route) => codeSplit ? route.metaComponentProperty : route.Component.metaComponentProperty\r\n\r\n\tconst createRenderFunctionForRoute = (route, { routePosition }) => {\r\n\t\tconst meta = getMetaFunction(route)\r\n\t\tconst shouldPassMetaComponentProperty = getShouldPassMetaComponentProperty(route)\r\n\r\n\t\treturn ({ Component, props, ...rest }) => {\r\n\t\t\t// * `Component` — The component for the route, if any. `null` if the component has not yet been loaded.\r\n\t\t\t// * `props` — The default props for the route component, specifically `match` with `data` as an additional property. `null` if `data` have not yet been loaded.\r\n\t\t\t// * `match` — (not used) `found`'s `Match` object. Includes: `routes`, `context` (contains `dispatch` and `getState()`), etc. https://github.com/4Catalyzer/found/blob/master/src/typeUtils.ts\r\n\r\n\t\t\tif (!Component || !props) {\r\n\t\t\t\t// `undefined` indicates that either the `Component` is not loaded yet\r\n\t\t\t\t// or the `data` for the route hasn't been loaded yet.\r\n\t\t\t\treturn undefined\r\n\t\t\t}\r\n\r\n\t\t\t// https://4catalyzer.github.io/found/docs/configuration/route-config\r\n\t\t\tconst {\r\n\t\t\t\t// match,\r\n\t\t\t\trouter,\r\n\t\t\t\tdata\r\n\t\t\t} = props\r\n\r\n\t\t\t// const { params } = match\r\n\r\n\t\t\tlet componentProps = {}\r\n\r\n\t\t\tif (data) {\r\n\t\t\t\tif (data.redirect) {\r\n\t\t\t\t\t// 307 Temporary Redirect\r\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/307\r\n\t\t\t\t\t// 308 Permanent Redirect\r\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/308\r\n\t\t\t\t\t// const redirectStatusCode = data.redirect.statusCode\r\n\t\t\t\t\tconst redirectStatusCode = undefined // is gonna be `302` by default in `found` router.\r\n\t\t\t\t\tthrow new RedirectException(data.redirect.url, redirectStatusCode)\r\n\t\t\t\t}\r\n\t\t\t\tif (data.props) {\r\n\t\t\t\t\tcomponentProps = {\r\n\t\t\t\t\t\t...data.props,\r\n\t\t\t\t\t\t...componentProps\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst renderComponent = () => React.createElement(Component, componentProps)\r\n\r\n\t\t\tconst renderMetaUpdaterComponent = (customProps) => {\r\n\t\t\t\treturn React.createElement(MetaUpdater, {\r\n\t\t\t\t\tmeta,\r\n\t\t\t\t\tstash,\r\n\t\t\t\t\troutePosition,\r\n\t\t\t\t\tprops: data && data.props,\r\n\t\t\t\t\tcustomProps\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tconst shouldUpdateMetaInRealTime = !server && meta\r\n\r\n\t\t\tif (shouldPassMetaComponentProperty) {\r\n\t\t\t\tif (shouldUpdateMetaInRealTime) {\r\n\t\t\t\t\tcomponentProps.Meta = renderMetaUpdaterComponent\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcomponentProps.Meta = EmptyComponent\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldUpdateMetaInRealTime) {\r\n\t\t\t\treturn React.createElement(\r\n\t\t\t\t\tMetaUpdaterAndPageComponent,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// Passing `componentElement` as `children` here didn't work\r\n\t\t\t\t\t\t// because `found` router overrides the `children` of the returned React Element.\r\n\t\t\t\t\t\tcomponentElement: renderComponent(),\r\n\t\t\t\t\t\tmetaUpdaterElement: renderMetaUpdaterComponent()\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t}\r\n\r\n\t\t\treturn renderComponent()\r\n\t\t}\r\n\t}\r\n\r\n\t// Set `render` function on the \"root\" route `Component`.\r\n\troutes[0].render = createRenderFunctionForRoute(routes[0], { routePosition: 'root' })\r\n\r\n\t// Set `render` function on the \"leaf\" route `Component`s.\r\n\tforEachLeafRoute(routes, (leafRoute) => {\r\n\t\tleafRoute.render = createRenderFunctionForRoute(leafRoute, { routePosition: 'leaf' })\r\n\t})\r\n\r\n\t// Set up redirects on routes.\r\n\t// https://4catalyzer.github.io/found/docs/advanced/redirects/\r\n\tforEachRoute(routes, (route) => {\r\n\t\tif (route.permanentRedirectTo) {\r\n\t\t\troute.render = () => {\r\n\t\t\t\t// 307 Temporary Redirect\r\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/307\r\n\t\t\t\t// 308 Permanent Redirect\r\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/308\r\n\t\t\t\t// 301 Moved Permanently (permanent redirect)\r\n\t\t\t\t// 302 Found (temporary redirect)\r\n\t\t\t\t// https://stackoverflow.com/questions/4764297/difference-between-http-redirect-codes\r\n\t\t\t\t// const redirectStatusCode = route.temporaryRedirectTo ? 302 : 301\r\n\t\t\t\tconst redirectStatusCode = 301\r\n\t\t\t\tthrow new RedirectException(\r\n\t\t\t\t\troute.permanentRedirectTo,\r\n\t\t\t\t\tredirectStatusCode\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n\r\n\t// // Collect `errorPages` map from routes' `default: true` properties.\r\n\t// const defaultErrorPages = {}\r\n\t// forEachRoute(routes, (route) => {\r\n\t// \tif (route.default) {\r\n\t// \t\tif (route.status) {\r\n\t// \t\t\tif (defaultErrorPages[route.status]) {\r\n\t// \t\t\t\tthrow new Error(`[react-pages] There already is a \\`default: true\\` route for \\`status: ${route.status}\\`: \"${getRoutePath(parentRoutes.concat(route))}\"`)\r\n\t// \t\t\t}\r\n\t// \t\t\tif (route.path.indexOf(':') >= 0) {\r\n\t// \t\t\t\tthrow new Error(`[react-pages] A \\`default: true\\` route's \\`path\\` can't contain a colon (\":\")`)\r\n\t// \t\t\t}\r\n\t// \t\t\tdefaultErrorPages[route.status] = route.path\r\n\t// \t\t}\r\n\t// \t}\r\n\t// })\r\n}\r\n\r\nfunction EmptyComponent() {\r\n\treturn null\r\n}\r\n\r\nfunction MetaUpdaterAndPageComponent({\r\n\tmetaUpdaterElement,\r\n\tcomponentElement,\r\n\t// `children` are passed by `found` router to the root route's component.\r\n\t// `children` may be `undefined` until `found` router has finished rendering the route.\r\n\tchildren\r\n}) {\r\n\t// https://stackoverflow.com/questions/27290013/how-to-render-multiple-children-without-jsx\r\n\treturn React.createElement(React.Fragment, null,\r\n\t\tmetaUpdaterElement,\r\n\t\tReact.cloneElement(componentElement, null, children)\r\n\t)\r\n}\r\n\r\n// function isEqualMeta(a, b) {\r\n// \tif (!a && !b) {\r\n// \t\treturn true\r\n// \t}\r\n// \tif (a && !b || !a && b) {\r\n// \t\treturn false\r\n// \t}\r\n// \tconst aKeys = Object.keys(a)\r\n// \tconst bKeys = Object.keys(b)\r\n// \tif (aKeys.length !== bKeys.length) {\r\n// \t\treturn false\r\n// \t}\r\n// \tfor (const key of aKeys) {\r\n// \t\tif (Array.isArray(a[key])) {\r\n// \t\t\tcheck that b[key] is an array\r\n// \t\t\tcompare array lengths\r\n// \t\t\tcompare array elements\r\n// \t\t} else if (isObject(a[key])) {\r\n// \t\t\tcheck that b[key] is an object\r\n// \t\t\tcompare objects\r\n// \t\t} else {\r\n// \t\t\tif (a[key] !== b[key]) {\r\n// \t\t\t\treturn false\r\n// \t\t\t}\r\n// \t\t}\r\n// \t}\r\n// \treturn true\r\n// }"],"mappings":"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AAG,GAAG;QAC9B,MAAM,IAAIC,wBAAiB,CAC1BhB,KAAK,CAACkC,mBAAmB,EACzBnB,kBAAkB,CAClB;MACF,CAAC;IACF;EACD,CAAC,CAAC;;EAEF;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACD;;AAEA,SAASW,cAAc,GAAG;EACzB,OAAO,IAAI;AACZ;AAEA,SAASC,2BAA2B,QAMjC;EAAA,IALFE,kBAAkB,SAAlBA,kBAAkB;IAClBD,gBAAgB,SAAhBA,gBAAgB;IAGhBO,QAAQ,SAARA,QAAQ;EAER;EACA,OAAOhB,iBAAK,CAACC,aAAa,CAACD,iBAAK,CAACiB,QAAQ,EAAE,IAAI,EAC9CP,kBAAkB,EAClBV,iBAAK,CAACkB,YAAY,CAACT,gBAAgB,EAAE,IAAI,EAAEO,QAAQ,CAAC,CACpD;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}