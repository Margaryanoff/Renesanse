{"version":3,"file":"store.js","names":["_createStore","data","initialState","createHistoryProtocol","httpClient","stash","settings","options","reducers","routes","pageStateReducerNames","reduxMiddleware","reduxStoreEnhancers","reduxEventNaming","http","onLoadError","getLocale","codeSplit","load","server","devtools","stats","context","onBeforeNavigate","onNavigationFinished","getCookie","validateRoutes","markPageStateReducers","createGetDataFunctionsForRoutes","createRenderFunctionsForRoutes","middleware","push","asynchronousMiddleware","onError","getErrorData","routerMiddleware","reportStats","storeEnhancers","applyMiddleware","getPropertyFromPropertyOrPropertyGetter","createRouterStoreEnhancers","basename","store","getStoreEnhancersComposer","createStore","createReducer","hotReload","replaceReducer","dispatch","initializeRouterAction","RESERVED_REDUCER_NAMES","reducerName","Error","checkForAutogeneratedEventNameCollision","ROUTER_REDUCER_NAME","foundReducer","REDUCER_NAME","reactPagesReducer","combineReducers","compose","composeWithDevTools","HISTORY_REDUCER_NAME","property","newReducers","Object","keys","key","indexOf","PAGE_STATE_REDUCER_NAME_PREFIX"],"sources":["../../lib/redux/store.js"],"sourcesContent":["import { createStore, combineReducers, applyMiddleware, compose } from 'redux'\r\nimport { composeWithDevToolsLogOnlyInProduction as composeWithDevTools } from '@redux-devtools/extension'\r\n\r\nimport asynchronousMiddleware from './middleware/asynchronous.js'\r\nimport routerMiddleware from './middleware/router.js'\r\n\r\nimport reactPagesReducer from './reducer.js'\r\n\r\nimport { REDUCER_NAME, PAGE_STATE_REDUCER_NAME_PREFIX } from './constants.js'\r\n\r\nimport { checkForAutogeneratedEventNameCollision } from './naming.js'\r\n\r\nimport validateRoutes from '../router/validateRoutes.js'\r\nimport createGetDataFunctionsForRoutes from './createGetDataFunctionsForRoutes.js'\r\nimport createRenderFunctionsForRoutes from './createRenderFunctionsForRoutes.js'\r\n\r\nimport {\r\n\tfoundReducer,\r\n\tcreateRouterStoreEnhancers\r\n} from '../router/index.js'\r\n\r\nimport {\r\n\tinitializeRouterAction\r\n} from '../router/actions.js'\r\n\r\nexport default function _createStore({\r\n\tinitialState: data,\r\n\tcreateHistoryProtocol,\r\n\thttpClient,\r\n\tstash,\r\n\tsettings,\r\n\toptions\r\n}) {\r\n\tlet {\r\n\t\treducers\r\n\t} = settings\r\n\r\n\tconst {\r\n\t\troutes,\r\n\t\tpageStateReducerNames,\r\n\t\treduxMiddleware,\r\n\t\treduxStoreEnhancers,\r\n\t\treduxEventNaming,\r\n\t\thttp,\r\n\t\tonLoadError,\r\n\t\tgetLocale,\r\n\t\tcodeSplit,\r\n\t\tload\r\n\t} = settings\r\n\r\n\tconst {\r\n\t\tserver,\r\n\t\tdevtools,\r\n\t\tstats,\r\n\t\tcontext,\r\n\t\tonBeforeNavigate,\r\n\t\tonNavigationFinished,\r\n\t\tgetCookie\r\n\t} = options\r\n\r\n\tvalidateRoutes(routes)\r\n\r\n\treducers = markPageStateReducers(reducers, pageStateReducerNames)\r\n\r\n\tcreateGetDataFunctionsForRoutes(routes, {\r\n\t\tstash,\r\n\t\tcodeSplit,\r\n\t\tserver,\r\n\t\tonLoadError,\r\n\t\tgetLocale,\r\n\t\tgetCookie,\r\n\t\tcontext\r\n\t})\r\n\r\n\tcreateRenderFunctionsForRoutes(routes, {\r\n\t\tstash,\r\n\t\tcodeSplit,\r\n\t\tserver\r\n\t})\r\n\r\n\t// Redux middleware.\r\n\tconst middleware = []\r\n\r\n\t// Built-in middleware.\r\n\tmiddleware.push(\r\n\t\t// Asynchronous middleware (e.g. for HTTP Ajax calls).\r\n\t\tasynchronousMiddleware({\r\n\t\t\thttpClient,\r\n\t\t\treduxEventNaming,\r\n\t\t\tserver,\r\n\t\t\tonError: http.onError,\r\n\t\t\tgetErrorData: http.getErrorData\r\n\t\t})\r\n\t)\r\n\r\n\tif (!server) {\r\n\t\tmiddleware.push(routerMiddleware({\r\n\t\t\troutes,\r\n\t\t\tcodeSplit,\r\n\t\t\tonBeforeNavigate,\r\n\t\t\tonNavigationFinished,\r\n\t\t\treportStats: stats,\r\n\t\t\tcontext,\r\n\t\t\tstash\r\n\t\t}))\r\n\t}\r\n\r\n\t// Redux \"store enhancers\"\r\n\tconst storeEnhancers = []\r\n\r\n\t// Add custom Redux middleware to store \"enhancers\".\r\n\t// Developers may supply their own (\"custom\") Redux middleware.\r\n\t//\r\n\t// Custom Redux middleware should be added to the start of the \"enhancers\" chain.\r\n\t// Otherwise, `dispatch(redirect(...))` from custom middleware won't work\r\n\t// because `farce`'s \"enhancer\" wouldn't \"see\" any actions dispatched from custom middleware.\r\n\t// https://github.com/reduxjs/redux/issues/1051\r\n\t//\r\n\t// Redux middleware are applied in reverse order relative to how they're passed\r\n\t// to `applyMiddleware()` function (which is counter-intuitive).\r\n\t// https://stackoverflow.com/questions/44342948/why-were-doing-slice-reverse-in-redux-applymiddleware-function\r\n\t//\r\n\tif (reduxMiddleware) {\r\n\t\tstoreEnhancers.push(applyMiddleware(...getPropertyFromPropertyOrPropertyGetter(reduxMiddleware)))\r\n\t}\r\n\r\n\t// User may supply his own Redux store enhancers.\r\n\tif (reduxStoreEnhancers) {\r\n\t\tstoreEnhancers.push(...getPropertyFromPropertyOrPropertyGetter(reduxStoreEnhancers))\r\n\t}\r\n\r\n\tstoreEnhancers.push(...createRouterStoreEnhancers(routes, createHistoryProtocol, {\r\n\t\tbasename: settings.basename\r\n\t}))\r\n\r\n\t// Add Redux middleware to store \"enhancers\".\r\n\t//\r\n\t// Redux middleware are applied in reverse order relative to how they're passed\r\n\t// to `applyMiddleware()` function (which is counter-intuitive).\r\n\t// https://stackoverflow.com/questions/44342948/why-were-doing-slice-reverse-in-redux-applymiddleware-function\r\n\t//\r\n\tstoreEnhancers.push(applyMiddleware(...middleware))\r\n\r\n\t// Create Redux store.\r\n\tconst store = getStoreEnhancersComposer(server, devtools)(...storeEnhancers)(createStore)(createReducer(reducers), data)\r\n\r\n\t// On the client side, add `hotReload()` function to the `store`.\r\n\t// (could just add this function to `window` but adding it to the `store` fits more)\r\n\tif (!server) {\r\n\t\t// `hotReload` helper function gives the web application means to hot reload its Redux reducers\r\n\t\tstore.hotReload = (reducers) => store.replaceReducer(createReducer(reducers))\r\n\t}\r\n\r\n\t// Initialize `found`.\r\n\tstore.dispatch(initializeRouterAction())\r\n\r\n\t// Return the Redux store\r\n\treturn store\r\n}\r\n\r\nfunction createReducer(reducers) {\r\n\t// Check for reserved reducer names.\r\n\tfor (const reducerName of RESERVED_REDUCER_NAMES) {\r\n\t\tif (reducers[reducerName]) {\r\n\t\t\tthrow new Error(`\"${reducerName}\" reducer name is reserved.`)\r\n\t\t}\r\n\t}\r\n\t// Check for `ReduxModule` autogenerated event names conflicts.\r\n\tcheckForAutogeneratedEventNameCollision(reducers)\r\n\t// Clone the object because it will be modified.\r\n\treducers = { ...reducers }\r\n\t// Add router reducer.\r\n\treducers[ROUTER_REDUCER_NAME] = foundReducer\r\n\t// Add `react-pages` reducer.\r\n\treducers[REDUCER_NAME] = reactPagesReducer\r\n\t// Create the combined reducer.\r\n\treturn combineReducers(reducers)\r\n}\r\n\r\nfunction getStoreEnhancersComposer(server, devtools) {\r\n\t// Redux DevTools aren't used on the server side\r\n\tif (server) {\r\n\t\treturn compose\r\n\t}\r\n\r\n\t// Custom behaviour\r\n\tif (devtools && devtools.compose) {\r\n\t\treturn devtools.compose(devtools.options)\r\n\t}\r\n\r\n\t// With custom options\r\n\tif (devtools && devtools.options) {\r\n\t\treturn composeWithDevTools(devtools.options)\r\n\t}\r\n\r\n\t// Without custom options\r\n\treturn composeWithDevTools\r\n}\r\n\r\n// `found` router library stores its state in \"found\" property of Redux state.\r\nexport const ROUTER_REDUCER_NAME = 'found'\r\n\r\n// `farce` history management library stores its state in \"location\" property of Redux state.\r\nconst HISTORY_REDUCER_NAME = 'location'\r\n\r\nconst RESERVED_REDUCER_NAMES = [\r\n\tREDUCER_NAME,\r\n\tROUTER_REDUCER_NAME,\r\n\tHISTORY_REDUCER_NAME\r\n]\r\n\r\n// Supports legacy ways of passing `reduxMiddleware` or `reduxStoreEnhancers`\r\n// when those two could be functions returning arrays rather than just arrays.\r\nfunction getPropertyFromPropertyOrPropertyGetter(property) {\r\n\tif (typeof property === 'function') {\r\n\t\treturn property()\r\n\t} else {\r\n\t\treturn property\r\n\t}\r\n}\r\n\r\nfunction markPageStateReducers(reducers, pageStateReducerNames) {\r\n\tconst newReducers = {}\r\n\r\n\tfor (const key of Object.keys(reducers)) {\r\n\t\tif (pageStateReducerNames && pageStateReducerNames.indexOf(key) >= 0) {\r\n\t\t\tnewReducers[PAGE_STATE_REDUCER_NAME_PREFIX + key] = reducers[key]\r\n\t\t} else {\r\n\t\t\tnewReducers[key] = reducers[key]\r\n\t\t}\r\n\t}\r\n\r\n\treturn newReducers\r\n}"],"mappings":"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"}