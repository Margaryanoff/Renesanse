{"version":3,"file":"chain.js","names":["_flags","require","_isObject","_interopRequireDefault","obj","__esModule","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","value","_toPropertyKey","configurable","writable","arg","_toPrimitive","_typeof","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","iterator","constructor","prototype","_createForOfIteratorHelper","o","allowArrayLike","it","Array","isArray","_unsupportedIterableToArray","F","s","n","done","e","_e","f","normalCompletion","didErr","err","step","next","_e2","minLen","_arrayLikeToArray","toString","slice","name","from","test","arr","len","arr2","generatePreloadChain","preloaders","server","isInitialClientSidePreload","getState","dispatch","location","params","history","getCookie","getContext","preloading","setUpPreloaders","filter_preloaders","chain","chain_preloaders","isCancelled","cancelled","createPromiseFromLoaders","preload_arguments","_iterator","_step","component_preloaders","_iterator2","_step2","preloader","setUpPreloader","preload","isServerSidePreloaded","options","client","_","parallel","concat","is_preloader_blocking","get_preloader","_iterator3","_step3","sibling_preloader","blocking","blockingSibling","isObject","Promise","all","map","subChain","then","results","isResult","reduce","combined","result","mergeResults","Error","promise","subChainResult","resolve","BLANK_RESULT","result1","result2","array","part"],"sources":["../../../lib/redux/load/chain.js"],"sourcesContent":["import { isServerSidePreloaded } from '../../client/flags.js'\r\nimport isObject from '../../isObject.js'\r\n\r\n// Returns function returning a Promise\r\n// which resolves when all the required page `load`s are resolved.\r\n//\r\n// If no preloading is needed, then returns nothing.\r\n//\r\nexport default function generatePreloadChain\r\n(\r\n\tpreloaders,\r\n\tserver,\r\n\tisInitialClientSidePreload,\r\n\tgetState,\r\n\tdispatch,\r\n\tlocation,\r\n\tparams,\r\n\thistory,\r\n\tgetCookie,\r\n\tgetContext,\r\n\tpreloading\r\n)\r\n{\r\n\t// Set `.preload({ ... })` function arguments,\r\n\t// and also set default `load` options.\r\n\tsetUpPreloaders(\r\n\t\tpreloaders,\r\n\t\t{\r\n\t\t\tdispatch,\r\n\t\t\tgetState,\r\n\t\t\tlocation,\r\n\t\t\tparams,\r\n\t\t\thistory,\r\n\t\t\tserver,\r\n\t\t\t// `getCookie` `load` parameter has been requested:\r\n\t\t\t// https://github.com/catamphetamine/react-website/issues/71\r\n\t\t\tgetCookie,\r\n\t\t\tgetContext\r\n\t\t},\r\n\t\tserver\r\n\t)\r\n\r\n\t// Only select those `load`s which\r\n\t// should be run in current circumstances.\r\n\tpreloaders = filter_preloaders(preloaders, server, isInitialClientSidePreload)\r\n\r\n\t// Construct a sequential chain out of preloaders.\r\n\t// Because each of them could be either parallel or sequential.\r\n\tconst chain = chain_preloaders(preloaders)\r\n\r\n\t// If there are no `load`s for this route, then exit.\r\n\tif (chain.length === 0) {\r\n\t\treturn\r\n\t}\r\n\r\n\t// Return a function which generates preloading `Promise` chain.\r\n\tconst isCancelled = () => preloading.cancelled\r\n\treturn () => createPromiseFromLoaders(chain, isCancelled)\r\n}\r\n\r\n// Applies default `load` options\r\n// and sets `load` function arguments.\r\nfunction setUpPreloaders(preloaders, preload_arguments, server)\r\n{\r\n\tfor (const component_preloaders of preloaders) {\r\n\t\tfor (const preloader of component_preloaders) {\r\n\t\t\tsetUpPreloader(preloader, preload_arguments, server)\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Applies default `load` options\r\n// and sets `load` function arguments.\r\nfunction setUpPreloader(preloader, preload_arguments, server)\r\n{\r\n\tconst preload = preloader.preload\r\n\tpreloader.preload = () => preload(preload_arguments)\r\n\r\n\t// If Server-Side Rendering is not being used at all\r\n\t// then all `load`s must be marked as client-side ones.\r\n\tif (!server && !isServerSidePreloaded()) {\r\n\t\tpreloader.options.client = true\r\n\t}\r\n}\r\n\r\n// Selects only those `load`s which\r\n// should be run in current circumstances.\r\nexport function filter_preloaders(preloaders, server, isInitialClientSidePreload)\r\n{\r\n\t// `preloaders` array will be mutated\r\n\tpreloaders = preloaders.slice()\r\n\r\n\tpreloaders.forEach((_, i) =>\r\n\t{\r\n\t\tpreloaders[i] = preloaders[i].filter((preloader) =>\r\n\t\t{\r\n\t\t\t// Don't execute client-side-only `load`s on server side\r\n\t\t\tif (preloader.options.client && server) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\t// Don't execute server-side-only `load`s on client side\r\n\t\t\tif (preloader.options.server && !server) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\t// If it's initial client side preload (after the page has been loaded),\r\n\t\t\t// then only execute those `load`s marked as \"client-side-only\".\r\n\t\t\tif (isInitialClientSidePreload && !preloader.options.client) {\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t\treturn true\r\n\t\t})\r\n\t})\r\n\r\n\treturn preloaders.filter(component_preloaders => component_preloaders.length > 0)\r\n}\r\n\r\n// Constructs `preload` chain.\r\n//\r\n// @param `preloaders` is an array of `component_preloaders`.\r\n// `component_preloaders` is an array of all\r\n// `load`s for a particular React component.\r\n// Therefore `preloaders` is an array of arrays.\r\nexport function chain_preloaders(preloaders, chain = [], parallel = [])\r\n{\r\n\t// If all `preload`s have been visited\r\n\tif (preloaders.length === 0)\r\n\t{\r\n\t\tif (parallel.length === 0) {\r\n\t\t\treturn chain\r\n\t\t}\r\n\t\t// Finalize pending parallel `preload`s\r\n\t\tif (parallel.length === 1) {\r\n\t\t\treturn chain.concat(parallel)\r\n\t\t}\r\n\t\treturn chain.concat({ parallel })\r\n\t}\r\n\r\n\t// `component_preloaders` is an array of all\r\n\t// `load`s for a particular React component.\r\n\tconst preloader = preloaders[0]\r\n\tpreloaders = preloaders.slice(1)\r\n\r\n\tif (!is_preloader_blocking(preloader))\r\n\t{\r\n\t\treturn chain_preloaders(\r\n\t\t\tpreloaders,\r\n\t\t\tchain,\r\n\t\t\tconcat(parallel, get_preloader(preloader))\r\n\t\t)\r\n\t}\r\n\r\n\tif (parallel.length === 0)\r\n\t{\r\n\t\treturn chain_preloaders(\r\n\t\t\tpreloaders,\r\n\t\t\tconcat(chain, get_preloader(preloader)),\r\n\t\t\t[]\r\n\t\t)\r\n\t}\r\n\r\n\treturn chain_preloaders(\r\n\t\tpreloaders,\r\n\t\tchain.concat({ parallel: concat(parallel, get_preloader(preloader)) }),\r\n\t\t[]\r\n\t)\r\n}\r\n\r\nfunction get_preloader(preloader)\r\n{\r\n\t// A list of same component's `load`s\r\n\tif (Array.isArray(preloader)) {\r\n\t\treturn chain_preloaders(preloader)\r\n\t}\r\n\r\n\t// Same component adjacent `load`\r\n\treturn preloader.preload\r\n}\r\n\r\nfunction is_preloader_blocking(preloader)\r\n{\r\n\t// A list of same component's `load`s\r\n\tif (Array.isArray(preloader))\r\n\t{\r\n\t\t// Determine the proper `blocking` option\r\n\t\t// for this component's `load`s.\r\n\t\tfor (const sibling_preloader of preloader)\r\n\t\t{\r\n\t\t\t// If any of component's `load`s are `blocking: true`\r\n\t\t\t// then all of them are `blocking: true`.\r\n\t\t\tif (sibling_preloader.options.blocking)\r\n\t\t\t{\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false\r\n\t}\r\n\r\n\t// Same component adjacent `load`\r\n\treturn preloader.options.blockingSibling\r\n}\r\n\r\n// Returns a `Promise` chain.\r\nexport function createPromiseFromLoaders(chain, isCancelled) {\r\n\tif (typeof chain === 'function') {\r\n\t\treturn chain()\r\n\t}\r\n\r\n\tif (isObject(chain)) {\r\n\t\tif (Array.isArray(chain.parallel)) {\r\n\t\t\treturn Promise.all(\r\n\t\t\t\tchain.parallel.map(subChain => createPromiseFromLoaders(subChain, isCancelled))\r\n\t\t\t)\r\n\t\t\t\t.then((results) => {\r\n\t\t\t\t\tif (isCancelled()) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn results.filter(isResult).reduce((combined, result) => {\r\n\t\t\t\t\t\tif (combined) {\r\n\t\t\t\t\t\t\treturn mergeResults(combined, result)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result\r\n\t\t\t\t\t}, undefined)\r\n\t\t\t\t})\r\n\t\t} else {\r\n\t\t\tthrow new Error('If loader chain element is an object then it should contain `parallel` property which should be an array of loader chains')\r\n\t\t}\r\n\t}\r\n\r\n\tif (Array.isArray(chain)) {\r\n\t\treturn chain.reduce((promise, subChain) => {\r\n\t\t\treturn promise.then((result) => {\r\n\t\t\t\tif (isCancelled()) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\treturn createPromiseFromLoaders(subChain, isCancelled).then((subChainResult) => {\r\n\t\t\t\t\tif (isResult(result)) {\r\n\t\t\t\t\t\tif (isResult(subChainResult)) {\r\n\t\t\t\t\t\t\treturn mergeResults(result, subChainResult)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn result\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn subChainResult\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}, Promise.resolve())\r\n\t}\r\n\r\n\tthrow new Error(`Unsupported loader chain: ${chain} of type ${typeof chain}`)\r\n}\r\n\r\nconst BLANK_RESULT = {}\r\n\r\nfunction isResult(result) {\r\n\tif (result === undefined) {\r\n\t\treturn false\r\n\t}\r\n\treturn isObject(result)\r\n}\r\n\r\nfunction mergeResults(result1, result2) {\r\n\treturn {\r\n\t\t...result1,\r\n\t\t...result2\r\n\t}\r\n}\r\n\r\nfunction concat(array, part)\r\n{\r\n\tif (Array.isArray(part) && part.length > 1) {\r\n\t\t// Pushes an array\r\n\t\treturn array.concat([part])\r\n\t}\r\n\t// Pushes a single element\r\n\treturn array.concat(part)\r\n}"],"mappings":"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"}