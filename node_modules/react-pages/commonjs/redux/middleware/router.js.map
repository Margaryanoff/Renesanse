{"version":3,"file":"router.js","names":["ON_PAGE_LOADED_METHOD_NAME","routerMiddleware","routes","codeSplit","onBeforeNavigate","onNavigationFinished","reportStats","context","stash","startedAt","isNavigatingToAnotherPage","previousLocation","previousRouteIndices","dispatch","getState","next","event","getFromContext","params","payload","location","routeIndices","routeParams","type","UPDATE_MATCH","isServerSideLoaded","setInContext","isSamePage","Date","now","_isInstantTransition","action","isInstantTransition","setInstantNavigationFlag","instantBack","isNavigationWithInstantBackAbility","addInstantBack","updateInstantNavigationChainIndex","resetInstantNavigationChain","routeChain","getRoutesByPath","pageRoute","length","navigationStartListener","route","getRoutePath","navigationContext","clearInContext","useSelector","getter","url","getLocationUrl","SET_NAVIGATION_LOCATION","LOAD_STARTED","RESOLVE_MATCH","_RESOLVE_MATCH","takeFromContext","Error","pathname","onPageLoaded","Component","updateMetaTags","time","loadAndRender","console","log","LOAD_FINISHED","meta","mergeMeta","rootMeta","pageMeta","applyMeta"],"sources":["../../../lib/redux/middleware/router.js"],"sourcesContent":["import { UPDATE_MATCH, RESOLVE_MATCH, _RESOLVE_MATCH } from '../../router/actions.js'\r\nimport { getRoutesByPath, getRoutePath } from '../../router/index.js'\r\nimport mergeMeta from '../../meta/mergeMeta.js'\r\nimport applyMeta from '../../meta/applyMeta.js'\r\nimport getLocationUrl from '../../getLocationUrl.js'\r\nimport shouldSkipLoadForNavigation from '../load/shouldSkipLoadForNavigation.js'\r\nimport isSamePage from '../../isSamePage.js'\r\n\r\nimport {\r\n\tLOAD_STARTED,\r\n\tLOAD_FINISHED,\r\n\tLOAD_FAILED\r\n} from '../load/actions.js'\r\n\r\nimport { SET_NAVIGATION_LOCATION } from '../navigation/actions.js'\r\n\r\nimport {\r\n\tisInstantTransition,\r\n\tsetInstantNavigationFlag,\r\n\taddInstantBack,\r\n\tupdateInstantNavigationChainIndex,\r\n\tresetInstantNavigationChain,\r\n\tisNavigationWithInstantBackAbility\r\n} from '../client/instantNavigation.js'\r\n\r\nimport { isServerSideLoaded } from '../../client/flags.js'\r\n\r\nimport { setInContext, getFromContext, clearInContext, takeFromContext } from '../../context.js'\r\n\r\nconst ON_PAGE_LOADED_METHOD_NAME = 'onLoaded'\r\n\r\n// Any events listened to here are being dispatched on client side.\r\nexport default function routerMiddleware({\r\n\troutes,\r\n\tcodeSplit,\r\n\tonBeforeNavigate,\r\n\tonNavigationFinished,\r\n\treportStats,\r\n\tcontext,\r\n\tstash\r\n}) {\r\n\t// `startedAt` is the time when the latest navigation has started.\r\n\t//\r\n\t// It gets updated when receiving a `UPDATE_MATCH` event\r\n\t// and then read when receiving a `RESOLVE_MATCH` event\r\n\t// to measure the time between `UPDATE_MATCH` and `RESOLVE_MATCH` events.\r\n\t//\r\n\tlet startedAt\r\n\r\n\t// This flag tells if the navigation is between different pages or not.\r\n\t// If it's not between different pages then `.load()` won't be called.\r\n\t//\r\n\t// It gets updated when receiving a `UPDATE_MATCH` event\r\n\t// and then read when receiving a `RESOLVE_MATCH` event.\r\n\t//\r\n\tlet isNavigatingToAnotherPage\r\n\r\n\t// `previousLocation` is the `location` the latest finished navigation.\r\n\t//\r\n\t// It gets updated when receiving a `RESOLVE_MATCH` event.\r\n\t//\r\n\tlet previousLocation\r\n\r\n\t// `previousRouteIndices` represents the full \"path\" to the `previousLocation` route.\r\n\t//\r\n\tlet previousRouteIndices\r\n\r\n\treturn ({ dispatch, getState }) =>\r\n\t{\r\n\t\treturn next => event =>\r\n\t\t{\r\n\t\t\t// Skip the first pass of the initial client-side render.\r\n\t\t\t// for the case when server-side rendering is used.\r\n\t\t\tif (getFromContext('InitialPage/RepeatingServerSideRenderOnClientSide')) {\r\n\t\t\t\treturn next(event)\r\n\t\t\t}\r\n\r\n\t\t\t// `event.payload` is a `MatcherResult`/`MatchBase` object\r\n\t\t\t// in case of a `UPDATE_MATCH`/`RESOLVE_MATCH` event.\r\n\t\t\t// https://github.com/4Catalyzer/found/blob/master/src/typeUtils.ts\r\n\t\t\tconst params = event.payload && event.payload.params\r\n\t\t\tconst location = event.payload && event.payload.location\r\n\t\t\tconst routeIndices = event.payload && event.payload.routeIndices\r\n\t\t\tconst routeParams = event.payload && event.payload.routeParams\r\n\r\n\t\t\t// `UPDATE_MATCH` event is triggered when navigation has started (only on client side).\r\n\t\t\t// `RESOLVE_MATCH` event is triggered when navigation has ended and the new page will be rendered (only on client side).\r\n\t\t\t//\r\n\t\t\tswitch (event.type) {\r\n\t\t\t\tcase UPDATE_MATCH:\r\n\t\t\t\t\t// Store `event.payload` for the future `_UPDATE_MATCH` event.\r\n\t\t\t\t\tif (!getFromContext('App/HasBeenRendered') && !isServerSideLoaded()) {\r\n\t\t\t\t\t\tsetInContext('InitialPage/FakeResolveMatchEventPayload', event.payload)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tisNavigatingToAnotherPage = !previousLocation || !isSamePage(previousLocation, location)\r\n\r\n\t\t\t\t\tif (isNavigatingToAnotherPage) {\r\n\t\t\t\t\t\t// Measure `load` and `render` time.\r\n\t\t\t\t\t\tstartedAt = Date.now()\r\n\r\n\t\t\t\t\t\t// If it's an instant \"Back\"/\"Forward\" navigation\r\n\t\t\t\t\t\t// then navigate to the page without loading it.\r\n\t\t\t\t\t\t// (has been previously loaded and is in Redux state)\r\n\t\t\t\t\t\tconst _isInstantTransition =\r\n\t\t\t\t\t\t\tlocation.action === 'POP' &&\r\n\t\t\t\t\t\t\tpreviousLocation &&\r\n\t\t\t\t\t\t\tisInstantTransition(previousLocation, location)\r\n\r\n\t\t\t\t\t\t// Set the flag for `wasInstantNavigation()`.\r\n\t\t\t\t\t\tsetInstantNavigationFlag(_isInstantTransition)\r\n\r\n\t\t\t\t\t\t// Indicates whether an `instantBack` `<Link/>` has been clicked.\r\n\t\t\t\t\t\t// (or if `goto()` has been called with `instantBack: true` option)\r\n\t\t\t\t\t\tconst instantBack = isNavigationWithInstantBackAbility()\r\n\r\n\t\t\t\t\t\t// Update instant back navigation chain.\r\n\t\t\t\t\t\tif (instantBack) {\r\n\t\t\t\t\t\t\t// Stores \"current\" (soon to be \"previous\") location\r\n\t\t\t\t\t\t\t// in \"instant back chain\", so that if \"Back\" is clicked\r\n\t\t\t\t\t\t\t// then such transition could be detected as \"should be instant\".\r\n\t\t\t\t\t\t\taddInstantBack(\r\n\t\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t\t\tpreviousLocation,\r\n\t\t\t\t\t\t\t\trouteIndices,\r\n\t\t\t\t\t\t\t\tpreviousRouteIndices\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t} else if (_isInstantTransition) {\r\n\t\t\t\t\t\t\tupdateInstantNavigationChainIndex(location)\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// If current transition is not \"instant back\" and not \"instant\"\r\n\t\t\t\t\t\t\t// then reset the whole \"instant back\" chain.\r\n\t\t\t\t\t\t\t// Only a consequitive \"instant back\" navigation chain\r\n\t\t\t\t\t\t\t// preserves the ability to instantly navigate \"Back\".\r\n\t\t\t\t\t\t\t// Once a regular navigation takes place\r\n\t\t\t\t\t\t\t// all previous \"instant back\" possibilities are discarded.\r\n\t\t\t\t\t\t\tresetInstantNavigationChain()\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Set the flag for `isInstantBackAbleNavigation()`.\r\n\t\t\t\t\t\t// `instantBack` is for a \"forward\" instant-back-able navigation.\r\n\t\t\t\t\t\t// `_isInstantTransition` is for a \"backwards\" instant-back-able navigation.\r\n\t\t\t\t\t\tsetInContext('Navigation/IsInstantBack', instantBack || _isInstantTransition)\r\n\r\n\t\t\t\t\t\t// Trigger \"before navigate to another page\" listeners.\r\n\t\t\t\t\t\tif (getFromContext('Navigation/BeforeNavigateToAnotherPage')) {\r\n\t\t\t\t\t\t\tconst routeChain = getRoutesByPath(routeIndices, routes)\r\n\t\t\t\t\t\t\tconst pageRoute = routeChain[routeChain.length - 1]\r\n\t\t\t\t\t\t\tfor (const navigationStartListener of getFromContext('Navigation/BeforeNavigateToAnotherPage')) {\r\n\t\t\t\t\t\t\t\tnavigationStartListener({\r\n\t\t\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t\t\t\troute: getRoutePath(getRoutesByPath(routeIndices, routes)),\r\n\t\t\t\t\t\t\t\t\tparams: routeParams,\r\n\t\t\t\t\t\t\t\t\tinstantBack: getFromContext('Navigation/IsInstantBack'),\r\n\t\t\t\t\t\t\t\t\tnavigationContext: getFromContext('Navigation/Context')\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tclearInContext('Navigation/BeforeNavigateToAnotherPage')\r\n\r\n\t\t\t\t\t\t// Trigger `onBeforeNavigate()` global listener.\r\n\t\t\t\t\t\tif (onBeforeNavigate) {\r\n\t\t\t\t\t\t\tonBeforeNavigate({\r\n\t\t\t\t\t\t\t\tdispatch,\r\n\t\t\t\t\t\t\t\tuseSelector: getter => getter(getState()),\r\n\t\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t\t\turl: getLocationUrl(location),\r\n\t\t\t\t\t\t\t\tparams,\r\n\t\t\t\t\t\t\t\tcontext\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// `UPDATE_MATCH`/`RESOLVE_MATCH` events aren't triggered on server side.\r\n\t\t\t\t\t// They're only triggered on client side.\r\n\t\t\t\t\t// If there was an error while navigating to a new `location`,\r\n\t\t\t\t\t// the `load` function will catch that error and `dispatch()`\r\n\t\t\t\t\t// a `SET_NAVIGATION_LOCATION` action with the `previousLocation`.\r\n\t\t\t\t\tdispatch({ type: SET_NAVIGATION_LOCATION, location })\r\n\r\n\t\t\t\t\t// If someone requires something like `useNavigationRoute()` hook in some future:\r\n\t\t\t\t\t// dispatch({ type: SET_NAVIGATION_ROUTE, { location, params, path: getRoutePath(getRoutesByPath(routeIndices, routes)) } })\r\n\r\n\t\t\t\t\t// Show page loading indicator.\r\n\t\t\t\t\tif (isServerSideLoaded()) {\r\n\t\t\t\t\t\t// Show page loading indicator.\r\n\t\t\t\t\t\tdispatch({ type: LOAD_STARTED, location })\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (getFromContext('App/HasBeenRendered')) {\r\n\t\t\t\t\t\t\t// Show page loading indicator.\r\n\t\t\t\t\t\t\tdispatch({ type: LOAD_STARTED, location })\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// The application React element doesn't get rendered\r\n\t\t\t\t\t\t\t// until the initial `load()` has finished.\r\n\t\t\t\t\t\t\t// Therefore, the usual \"show loading during navigation\"\r\n\t\t\t\t\t\t\t// component won't be rendered too.\r\n\t\t\t\t\t\t\t// Use `InitialLoadComponent` configuration parameter\r\n\t\t\t\t\t\t\t// to show a loading indicator during the initial load.\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// `LOAD_STARTED` event is not dispatched\r\n\t\t\t\t\t\t\t// because there's no one listening to Redux state changes yet.\r\n\t\t\t\t\t\t\t//\r\n\t\t\t\t\t\t\t// `SET_NAVIGATION_LOCATION` event has been dispatched\r\n\t\t\t\t\t\t\t// to set `navigationLocation` property in Redux state.\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak\r\n\r\n\t\t\t\t// `UPDATE_MATCH` event is triggered when navigation starts (only on client side).\r\n\t\t\t\t// `RESOLVE_MATCH` event is triggered when navigation ends (only on client side).\r\n\t\t\t\t//\r\n\t\t\t\t// In `found` router, `RESOLVE_MATCH` is not being dispatched\r\n\t\t\t\t// for the first render for some weird reason.\r\n\t\t\t\t// https://github.com/4Catalyzer/found/issues/202\r\n\t\t\t\t//\r\n\t\t\t\t// With server-side rendering enabled,\r\n\t\t\t\t// initially there are two rendering passes\r\n\t\t\t\t// and therefore `RESOLVE_MATCH` does get dispatched\r\n\t\t\t\t// after the page is initialized and rendered,\r\n\t\t\t\t// so there's no need to work around `RESOLVE_MATCH`\r\n\t\t\t\t// not being dispatched (because it is dispatched).\r\n\t\t\t\t//\r\n\t\t\t\t// With server-side rendering disabled,\r\n\t\t\t\t// `RESOLVE_MATCH` does not get dispatched,\r\n\t\t\t\t// therefore a custom `_RESOLVE_MATCH` event is\r\n\t\t\t\t// dispatched manually to mimick a `RESOLVE_MATCH` event.\r\n\t\t\t\t//\r\n\t\t\t\tcase RESOLVE_MATCH:\r\n\t\t\t\tcase _RESOLVE_MATCH:\r\n\t\t\t\t\tif (takeFromContext('Navigation/IgnoreResolveMatchRouterEvent')) {\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// `routeIndices` might be `undefined` after a `<Redirect/>`\r\n\t\t\t\t\t// is made and a user clicks the \"Back\" button in a web browser.\r\n\t\t\t\t\t// https://github.com/4Catalyzer/found/issues/632\r\n\t\t\t\t\tif (!routeIndices) {\r\n\t\t\t\t\t\tthrow new Error(`\"${event.type}\" Redux action misses \"routeIndices\" property. This usually means that the target URL path \"${location.pathname}\" didn't match any route. ${location.pathname[0] !== '/' ? 'The target URL path is missing a leading slash: correct your routes configuration to include a leading slash for \"' + location.pathname + '\" path. ' : ''}See the issue for more info: https://github.com/4Catalyzer/found/issues/632`)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (!getFromContext('App/HasBeenRendered')) {\r\n\t\t\t\t\t\tsetInContext('App/HasBeenRendered', true)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetInContext('Navigation/PreviousRoutes', routeIndices)\r\n\t\t\t\t\tsetInContext('Navigation/PreviousRoutesParameters', routeParams)\r\n\r\n\t\t\t\t\tpreviousLocation = location\r\n\t\t\t\t\tpreviousRouteIndices = routeIndices\r\n\r\n\t\t\t\t\tif (isNavigatingToAnotherPage) {\r\n\t\t\t\t\t\t// Call `onLoaded()` function of the page `Component`.\r\n\t\t\t\t\t\tif (!codeSplit) {\r\n\t\t\t\t\t\t\tconst routeChain = getRoutesByPath(routeIndices, routes)\r\n\t\t\t\t\t\t\tconst pageRoute = routeChain[routeChain.length - 1]\r\n\t\t\t\t\t\t\t// Routes don't have `.Component` property\r\n\t\t\t\t\t\t\t// set when using `codeSplit` feature.\r\n\t\t\t\t\t\t\tconst onPageLoaded = pageRoute.Component[ON_PAGE_LOADED_METHOD_NAME]\r\n\t\t\t\t\t\t\tif (onPageLoaded) {\r\n\t\t\t\t\t\t\t\tonPageLoaded({\r\n\t\t\t\t\t\t\t\t\tdispatch,\r\n\t\t\t\t\t\t\t\t\tuseSelector: getter => getter(getState()),\r\n\t\t\t\t\t\t\t\t\tlocation\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Update `<meta/>` tags.\r\n\t\t\t\t\t\tupdateMetaTags({\r\n\t\t\t\t\t\t\troutes,\r\n\t\t\t\t\t\t\trouteIndices,\r\n\t\t\t\t\t\t\tuseSelector: getter => getter(getState()),\r\n\t\t\t\t\t\t\tcodeSplit,\r\n\t\t\t\t\t\t\tstash\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t// Set \"initial `<meta/>` has been applied\" flag.\r\n\t\t\t\t\t\tif (!getFromContext('App/InitialMetaHasBeenApplied')) {\r\n\t\t\t\t\t\t\tsetInContext('App/InitialMetaHasBeenApplied', true)\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Call `onNavigationFinished()` global listener.\r\n\t\t\t\t\t\tif (onNavigationFinished) {\r\n\t\t\t\t\t\t\tonNavigationFinished({\r\n\t\t\t\t\t\t\t\turl: getLocationUrl(location),\r\n\t\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t\t\tparams,\r\n\t\t\t\t\t\t\t\tcontext,\r\n\t\t\t\t\t\t\t\tdispatch,\r\n\t\t\t\t\t\t\t\tuseSelector: getter => getter(getState())\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Report page loading time.\r\n\t\t\t\t\t\t// This loading time will be longer then\r\n\t\t\t\t\t\t// the server-side one, say, by 10 milliseconds,\r\n\t\t\t\t\t\t// probably because the web browser making\r\n\t\t\t\t\t\t// an asynchronous HTTP request is slower\r\n\t\t\t\t\t\t// than the Node.js server making a regular HTTP request.\r\n\t\t\t\t\t\t// Also this includes network latency\r\n\t\t\t\t\t\t// for a particular website user, etc.\r\n\t\t\t\t\t\t// So this `load` time doesn't actually describe\r\n\t\t\t\t\t\t// the server-side performance.\r\n\t\t\t\t\t\tif (reportStats) {\r\n\t\t\t\t\t\t\treportStats({\r\n\t\t\t\t\t\t\t\turl: getLocationUrl(location),\r\n\t\t\t\t\t\t\t\t// Concatenated route `path` string.\r\n\t\t\t\t\t\t\t\t// E.g. \"/user/:user_id/post/:post_id\"\r\n\t\t\t\t\t\t\t\troute: getRoutePath(getRoutesByPath(routeIndices, routes)),\r\n\t\t\t\t\t\t\t\ttime: {\r\n\t\t\t\t\t\t\t\t\tloadAndRender: Date.now() - startedAt\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Report loading time in console for debugging.\r\n\t\t\t\t\t\tif (Date.now() - startedAt > 30) {\r\n\t\t\t\t\t\t\tconsole.log(`[react-pages] \"${location.pathname}\" loaded and rendered in ${Date.now() - startedAt} ms`)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Hide page loading indicator.\r\n\t\t\t\t\tdispatch({ type: LOAD_FINISHED })\r\n\r\n\t\t\t\t\t// It could clear `startedAt` value here but that wouldn't work in all cases.\r\n\t\t\t\t\t// For example, if there's an error thrown from the `load()` function of the page,\r\n\t\t\t\t\t// `RESOLVE_MATCH` event wouldn't be emitted.\r\n\t\t\t\t\t//\r\n\t\t\t\t\t// startedAt = undefined\r\n\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\r\n\t\t\treturn next(event)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction updateMetaTags({\r\n\troutes,\r\n\trouteIndices,\r\n\tuseSelector,\r\n\tcodeSplit,\r\n\tstash\r\n}) {\r\n\tconst routeChain = getRoutesByPath(routeIndices, routes)\r\n\tconst pageRoute = routeChain[routeChain.length - 1]\r\n\r\n\tconst meta = mergeMeta({\r\n\t\trootMeta: codeSplit ? routes[0].meta : routes[0].Component.meta,\r\n\t\tpageMeta: codeSplit ? pageRoute.meta : pageRoute.Component.meta,\r\n\t\tuseSelector,\r\n\t\tstash\r\n\t})\r\n\r\n\t// Update `<meta/>`.\r\n\tapplyMeta(meta)\r\n}"],"mappings":"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"}