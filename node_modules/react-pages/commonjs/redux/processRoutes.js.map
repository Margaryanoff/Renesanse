{"version":3,"file":"processRoutes.js","names":["processRoutes","routes","stash","codeSplit","server","onLoadError","getLocale","getCookie","customContext","context","validateRoutes","getLoadFunction","route","load","Component","getMetaFunction","meta","getShouldPassMetaComponentProperty","metaComponentProperty","getRenderFunctionForRoute","routePosition","shouldPassMetaComponentProperty","props","rest","undefined","router","data","componentProps","redirect","redirectStatusCode","RedirectException","url","renderComponent","React","createElement","renderMetaUpdaterComponent","customProps","MetaUpdater","shouldUpdateMetaInRealTime","Meta","EmptyComponent","MetaUpdaterAndPageComponent","componentElement","metaUpdaterElement","getData","createGetDataFunction","onError","render","forEachLeafRoute","leafRoute","defer","forEachRoute","permanentRedirectTo","parameters","params","dispatch","getState","action","origin","children","Fragment","cloneElement"],"sources":["../../lib/redux/processRoutes.js"],"sourcesContent":["import React from 'react'\r\n\r\nimport { RedirectException } from '../router/index.js'\r\nimport getRoutePath from '../router/getRoutePath.js'\r\nimport forEachRoute from '../router/forEachRoute.js'\r\nimport forEachLeafRoute from '../router/forEachLeafRoute.js'\r\nimport validateRoutes from '../router/validateRoutes.js'\r\n\r\nimport MetaUpdater from './meta/MetaUpdater.js'\r\n\r\nimport getData from './load/getData.js'\r\n\r\nexport default function processRoutes(routes, {\r\n\tstash,\r\n\tcodeSplit,\r\n\tserver,\r\n\tonLoadError,\r\n\tgetLocale,\r\n\tgetCookie,\r\n\tcontext: customContext\r\n}) {\r\n\tvalidateRoutes(routes)\r\n\r\n\tconst getLoadFunction = (route) => codeSplit ? route.load : route.Component.load\r\n\tconst getMetaFunction = (route) => codeSplit ? route.meta : route.Component.meta\r\n\tconst getShouldPassMetaComponentProperty = (route) => codeSplit ? route.metaComponentProperty : route.Component.metaComponentProperty\r\n\r\n\tconst getRenderFunctionForRoute = (route, { routePosition }) => {\r\n\t\tconst meta = getMetaFunction(route)\r\n\t\tconst shouldPassMetaComponentProperty = getShouldPassMetaComponentProperty(route)\r\n\r\n\t\treturn ({ Component, props, ...rest }) => {\r\n\t\t\t// * `Component` — The component for the route, if any. `null` if the component has not yet been loaded.\r\n\t\t\t// * `props` — The default props for the route component, specifically `match` with `data` as an additional property. `null` if `data` have not yet been loaded.\r\n\t\t\t// * `match` — (not used) `found`'s `Match` object. Includes: `routes`, `context` (contains `dispatch` and `getState()`), etc. https://github.com/4Catalyzer/found/blob/master/src/typeUtils.ts\r\n\r\n\t\t\tif (!Component || !props) {\r\n\t\t\t\t// `undefined` indicates that either the `Component` is not loaded yet\r\n\t\t\t\t// or the `data` for the route hasn't been loaded yet.\r\n\t\t\t\treturn undefined\r\n\t\t\t}\r\n\r\n\t\t\t// https://4catalyzer.github.io/found/docs/configuration/route-config\r\n\t\t\tconst {\r\n\t\t\t\t// match,\r\n\t\t\t\trouter,\r\n\t\t\t\tdata\r\n\t\t\t} = props\r\n\r\n\t\t\t// const { params } = match\r\n\r\n\t\t\tlet componentProps = {}\r\n\r\n\t\t\tif (data) {\r\n\t\t\t\tif (data.redirect) {\r\n\t\t\t\t\t// 307 Temporary Redirect\r\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/307\r\n\t\t\t\t\t// 308 Permanent Redirect\r\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/308\r\n\t\t\t\t\t// const redirectStatusCode = data.redirect.statusCode\r\n\t\t\t\t\tconst redirectStatusCode = undefined // is gonna be `302` by default in `found` router.\r\n\t\t\t\t\tthrow new RedirectException(data.redirect.url, redirectStatusCode)\r\n\t\t\t\t}\r\n\t\t\t\tif (data.props) {\r\n\t\t\t\t\tcomponentProps = {\r\n\t\t\t\t\t\t...data.props,\r\n\t\t\t\t\t\t...componentProps\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst renderComponent = () => React.createElement(Component, componentProps)\r\n\r\n\t\t\tconst renderMetaUpdaterComponent = (customProps) => {\r\n\t\t\t\treturn React.createElement(MetaUpdater, {\r\n\t\t\t\t\tmeta,\r\n\t\t\t\t\tstash,\r\n\t\t\t\t\troutePosition,\r\n\t\t\t\t\tprops: data && data.props,\r\n\t\t\t\t\tcustomProps\r\n\t\t\t\t})\r\n\t\t\t}\r\n\r\n\t\t\tconst shouldUpdateMetaInRealTime = !server && meta\r\n\r\n\t\t\tif (shouldPassMetaComponentProperty) {\r\n\t\t\t\tif (shouldUpdateMetaInRealTime) {\r\n\t\t\t\t\tcomponentProps.Meta = renderMetaUpdaterComponent\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcomponentProps.Meta = EmptyComponent\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldUpdateMetaInRealTime) {\r\n\t\t\t\treturn React.createElement(\r\n\t\t\t\t\tMetaUpdaterAndPageComponent,\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// Passing `componentElement` as `children` here didn't work\r\n\t\t\t\t\t\t// because `found` router overrides the `children` of the returned React Element.\r\n\t\t\t\t\t\tcomponentElement: renderComponent(),\r\n\t\t\t\t\t\tmetaUpdaterElement: renderMetaUpdaterComponent()\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t}\r\n\r\n\t\t\treturn renderComponent()\r\n\t\t}\r\n\t}\r\n\r\n\t// Set `getData` function on the root route's `Component`.\r\n\t// https://4catalyzer.github.io/found/docs/configuration/route-config#data-or-getdata\r\n\tif (getLoadFunction(routes[0])) {\r\n\t\troutes[0].getData = createGetDataFunction({\r\n\t\t\troutePosition: 'root',\r\n\t\t\troutes,\r\n\t\t\tcodeSplit,\r\n\t\t\tserver,\r\n\t\t\tonError: onLoadError,\r\n\t\t\tgetLocale,\r\n\t\t\tgetCookie,\r\n\t\t\tcontext: customContext,\r\n\t\t\tstash\r\n\t\t})\r\n\t}\r\n\r\n\troutes[0].render = getRenderFunctionForRoute(routes[0], { routePosition: 'root' })\r\n\r\n\t// Set `getData` function on the \"leaf\" route `Component`s.\r\n\t// https://4catalyzer.github.io/found/docs/configuration/route-config#data-or-getdata\r\n\r\n\tforEachLeafRoute(routes, (leafRoute) => {\r\n\t\tif (getLoadFunction(leafRoute)) {\r\n\t\t\tleafRoute.getData = createGetDataFunction({\r\n\t\t\t\troutePosition: 'leaf',\r\n\t\t\t\troutes,\r\n\t\t\t\tcodeSplit,\r\n\t\t\t\tserver,\r\n\t\t\t\tonError: onLoadError,\r\n\t\t\t\tgetLocale,\r\n\t\t\t\tgetCookie,\r\n\t\t\t\tcontext: customContext,\r\n\t\t\t\tstash\r\n\t\t\t})\r\n\r\n\t\t\t// `defer: true` instructs `getData` of this route and all of its descendants\r\n\t\t\t// to wait for all parent route `getData` promises.\r\n\t\t\t//\r\n\t\t\t// \"Setting defer on a route will make the resolver defer calling its\r\n\t\t\t//  getData method and the getData methods on all of its descendants until\r\n\t\t\t//  all of its parent data promises have resolved.\"\r\n\t\t\t//\r\n\t\t\t// https://4catalyzer.github.io/found/docs/configuration/route-config\r\n\t\t\tleafRoute.defer = true\r\n\t\t}\r\n\r\n\t\tleafRoute.render = getRenderFunctionForRoute(leafRoute, { routePosition: 'leaf' })\r\n\t})\r\n\r\n\t// Set up redirects on routes.\r\n\t// https://4catalyzer.github.io/found/docs/advanced/redirects/\r\n\tforEachRoute(routes, (route) => {\r\n\t\tif (route.permanentRedirectTo) {\r\n\t\t\troute.render = () => {\r\n\t\t\t\t// 307 Temporary Redirect\r\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/307\r\n\t\t\t\t// 308 Permanent Redirect\r\n\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/308\r\n\t\t\t\t// 301 Moved Permanently (permanent redirect)\r\n\t\t\t\t// 302 Found (temporary redirect)\r\n\t\t\t\t// https://stackoverflow.com/questions/4764297/difference-between-http-redirect-codes\r\n\t\t\t\t// const redirectStatusCode = route.temporaryRedirectTo ? 302 : 301\r\n\t\t\t\tconst redirectStatusCode = 301\r\n\t\t    throw new RedirectException(\r\n\t\t    \troute.permanentRedirectTo,\r\n\t\t    \tredirectStatusCode\r\n\t\t    )\r\n\t\t  }\r\n\t\t}\r\n\t})\r\n\r\n\t// // Collect `errorPages` map from routes' `default: true` properties.\r\n\t// const defaultErrorPages = {}\r\n\t// forEachRoute(routes, (route) => {\r\n\t// \tif (route.default) {\r\n\t// \t\tif (route.status) {\r\n\t// \t\t\tif (defaultErrorPages[route.status]) {\r\n\t// \t\t\t\tthrow new Error(`[react-pages] There already is a \\`default: true\\` route for \\`status: ${route.status}\\`: \"${getRoutePath(parentRoutes.concat(route))}\"`)\r\n\t// \t\t\t}\r\n\t// \t\t\tif (route.path.indexOf(':') >= 0) {\r\n\t// \t\t\t\tthrow new Error(`[react-pages] A \\`default: true\\` route's \\`path\\` can't contain a colon (\":\")`)\r\n\t// \t\t\t}\r\n\t// \t\t\tdefaultErrorPages[route.status] = route.path\r\n\t// \t\t}\r\n\t// \t}\r\n\t// })\r\n}\r\n\r\nfunction createGetDataFunction(parameters) {\r\n\t// The `context` parameter is the `matchContext` parameter that's passed in `./lib/router/index.js`.\r\n\t// https://4catalyzer.github.io/found/docs/configuration/route-config#data-or-getdata\r\n\treturn function({ params, context: { dispatch, getState } }) {\r\n\t\treturn getData({\r\n\t\t\t...parameters,\r\n\t\t\tparams,\r\n\t\t\tdispatch: (action) => {\r\n\t\t\t\t// This `if` prevents an error message in console:\r\n\t\t\t\t// \"Error: Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.\".\r\n\t\t\t\t// That error message was appearing when `{origin: 'load'}` action was dispatched\r\n\t\t\t\t// as a result of someone accidentally calling `dispatch()` with no action argument.\r\n\t\t\t\tif (action) {\r\n\t\t\t\t\taction = {\r\n\t\t\t\t\t\t...action,\r\n\t\t\t\t\t\t// The `origin: \"load\"` parameter is used in `middleware/asynchronous.js`\r\n\t\t\t\t\t\t// to detect HTTP calls originating from `load()` functions.\r\n\t\t\t\t\t\torigin: 'load'\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn dispatch(action)\r\n\t\t\t},\r\n\t\t\tgetState\r\n\t\t})\r\n\t}\r\n}\r\n\r\nfunction EmptyComponent() {\r\n\treturn null\r\n}\r\n\r\nfunction MetaUpdaterAndPageComponent({\r\n\tmetaUpdaterElement,\r\n\tcomponentElement,\r\n\t// `children` are passed by `found` router to the root route's component.\r\n\t// `children` may be `undefined` until `found` router has finished rendering the route.\r\n\tchildren\r\n}) {\r\n\t// https://stackoverflow.com/questions/27290013/how-to-render-multiple-children-without-jsx\r\n\treturn React.createElement(React.Fragment, null,\r\n\t\tmetaUpdaterElement,\r\n\t\tReact.cloneElement(componentElement, null, children)\r\n\t)\r\n}\r\n\r\n// function isEqualMeta(a, b) {\r\n// \tif (!a && !b) {\r\n// \t\treturn true\r\n// \t}\r\n// \tif (a && !b || !a && b) {\r\n// \t\treturn false\r\n// \t}\r\n// \tconst aKeys = Object.keys(a)\r\n// \tconst bKeys = Object.keys(b)\r\n// \tif (aKeys.length !== bKeys.length) {\r\n// \t\treturn false\r\n// \t}\r\n// \tfor (const key of aKeys) {\r\n// \t\tif (Array.isArray(a[key])) {\r\n// \t\t\tcheck that b[key] is an array\r\n// \t\t\tcompare array lengths\r\n// \t\t\tcompare array elements\r\n// \t\t} else if (isObject(a[key])) {\r\n// \t\t\tcheck that b[key] is an object\r\n// \t\t\tcompare objects\r\n// \t\t} else {\r\n// \t\t\tif (a[key] !== b[key]) {\r\n// \t\t\t\treturn false\r\n// \t\t\t}\r\n// \t\t}\r\n// \t}\r\n// \treturn true\r\n// }"],"mappings":"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"}