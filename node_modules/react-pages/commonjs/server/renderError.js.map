{"version":3,"file":"renderError.js","names":["renderError","error","options","process","env","NODE_ENV","renderStackTrace","status","content","contentType","console","log","stack","message","html","response","headers","split","trim","getStackTrace","original"],"sources":["../../lib/server/renderError.js"],"sourcesContent":["import { html } from 'print-error'\r\n\r\n// Outputs an error page\r\nexport default function renderError(error, options)\r\n{\r\n\t// If the error is caught here it means that `catch`\r\n\t// (error handler parameter) didn't resolve it\r\n\t// (or threw it)\r\n\r\n\t// Show error stack trace in development mode for easier debugging\r\n\tif (process.env.NODE_ENV !== 'production') {\r\n\t\ttry {\r\n\t\t\tconst { status = 500, content } = renderStackTrace(error, options)\r\n\r\n\t\t\tif (content) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstatus,\r\n\t\t\t\t\tcontent,\r\n\t\t\t\t\tcontentType: 'text/html'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.log('[react-pages] Couldn\\'t render error stack trace.')\r\n\t\t\tconsole.log(error.stack || error)\r\n\t\t}\r\n\t}\r\n\r\n\t// Log the error\r\n\tconsole.log('[react-pages] Rendering service error')\r\n\t// console.error(error)\r\n\r\n\treturn {\r\n\t\tstatus: typeof error.status === 'number' ? error.status : 500,\r\n\t\tcontent: error.message || 'Error',\r\n\t\tcontentType: 'text/plain'\r\n\t}\r\n}\r\n\r\nfunction renderStackTrace(error, options)\r\n{\r\n\t// Supports custom `html` for an `Error`\r\n\tif (error.html) {\r\n\t\treturn {\r\n\t\t\tstatus  : error.status,\r\n\t\t\tcontent : error.html\r\n\t\t}\r\n\t}\r\n\r\n\t// Handle `superagent` errors: if an error response was an html, then just render it\r\n\t// https://github.com/visionmedia/superagent/blob/29ca1fc938b974c6623d9040a044e39dfb272fed/lib/node/response.js#L106\r\n\tif (typeof error.status === 'number') {\r\n\t\t// If the `superagent` http request returned an html response\r\n\t\t// (possibly an error stack trace),\r\n\t\t// then just output that stack trace\r\n\t\tif (error.response\r\n\t\t\t&& error.response.headers['content-type']\r\n\t\t\t&& error.response.headers['content-type'].split(';')[0].trim() === 'text/html') {\r\n\t\t\treturn {\r\n\t\t\t\tstatus  : error.status,\r\n\t\t\t\tcontent : error.message\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// If this error has a stack trace then it can be shown\r\n\tconst stack = getStackTrace(error)\r\n\r\n\t// If this error doesn't have a stack trace - do nothing\r\n\tif (!stack) {\r\n\t\treturn {}\r\n\t}\r\n\r\n\ttry {\r\n\t\treturn {\r\n\t\t\tcontent : html({ stack }, options)\r\n\t\t}\r\n\t} catch (error) {\r\n\t\tconsole.error(error)\r\n\t\treturn {\r\n\t\t\tcontent : error.stack\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Extracts stack trace from `Error`\r\nfunction getStackTrace(error)\r\n{\r\n\t// Standard javascript `Error` stack trace\r\n\tif (error.stack) {\r\n\t\treturn error.stack\r\n\t}\r\n\r\n\t// `superagent` errors have the `original` property\r\n\t// for storing the initial error\r\n\tif (error.original && error.original.stack) {\r\n\t\treturn error.original.stack\r\n\t}\r\n}"],"mappings":";;;;;;AAAA;AAEA;AACe,SAASA,WAAW,CAACC,KAAK,EAAEC,OAAO,EAClD;EACC;EACA;EACA;;EAEA;EACA,IAAIC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;IAC1C,IAAI;MACH,wBAAkCC,gBAAgB,CAACL,KAAK,EAAEC,OAAO,CAAC;QAAA,0CAA1DK,MAAM;QAANA,MAAM,sCAAG,GAAG;QAAEC,OAAO,qBAAPA,OAAO;MAE7B,IAAIA,OAAO,EAAE;QACZ,OAAO;UACND,MAAM,EAANA,MAAM;UACNC,OAAO,EAAPA,OAAO;UACPC,WAAW,EAAE;QACd,CAAC;MACF;IACD,CAAC,CAAC,OAAOR,KAAK,EAAE;MACfS,OAAO,CAACC,GAAG,CAAC,mDAAmD,CAAC;MAChED,OAAO,CAACC,GAAG,CAACV,KAAK,CAACW,KAAK,IAAIX,KAAK,CAAC;IAClC;EACD;;EAEA;EACAS,OAAO,CAACC,GAAG,CAAC,uCAAuC,CAAC;EACpD;;EAEA,OAAO;IACNJ,MAAM,EAAE,OAAON,KAAK,CAACM,MAAM,KAAK,QAAQ,GAAGN,KAAK,CAACM,MAAM,GAAG,GAAG;IAC7DC,OAAO,EAAEP,KAAK,CAACY,OAAO,IAAI,OAAO;IACjCJ,WAAW,EAAE;EACd,CAAC;AACF;AAEA,SAASH,gBAAgB,CAACL,KAAK,EAAEC,OAAO,EACxC;EACC;EACA,IAAID,KAAK,CAACa,IAAI,EAAE;IACf,OAAO;MACNP,MAAM,EAAIN,KAAK,CAACM,MAAM;MACtBC,OAAO,EAAGP,KAAK,CAACa;IACjB,CAAC;EACF;;EAEA;EACA;EACA,IAAI,OAAOb,KAAK,CAACM,MAAM,KAAK,QAAQ,EAAE;IACrC;IACA;IACA;IACA,IAAIN,KAAK,CAACc,QAAQ,IACdd,KAAK,CAACc,QAAQ,CAACC,OAAO,CAAC,cAAc,CAAC,IACtCf,KAAK,CAACc,QAAQ,CAACC,OAAO,CAAC,cAAc,CAAC,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAACC,IAAI,EAAE,KAAK,WAAW,EAAE;MAChF,OAAO;QACNX,MAAM,EAAIN,KAAK,CAACM,MAAM;QACtBC,OAAO,EAAGP,KAAK,CAACY;MACjB,CAAC;IACF;EACD;;EAEA;EACA,IAAMD,KAAK,GAAGO,aAAa,CAAClB,KAAK,CAAC;;EAElC;EACA,IAAI,CAACW,KAAK,EAAE;IACX,OAAO,CAAC,CAAC;EACV;EAEA,IAAI;IACH,OAAO;MACNJ,OAAO,EAAG,IAAAM,gBAAI,EAAC;QAAEF,KAAK,EAALA;MAAM,CAAC,EAAEV,OAAO;IAClC,CAAC;EACF,CAAC,CAAC,OAAOD,KAAK,EAAE;IACfS,OAAO,CAACT,KAAK,CAACA,KAAK,CAAC;IACpB,OAAO;MACNO,OAAO,EAAGP,KAAK,CAACW;IACjB,CAAC;EACF;AACD;;AAEA;AACA,SAASO,aAAa,CAAClB,KAAK,EAC5B;EACC;EACA,IAAIA,KAAK,CAACW,KAAK,EAAE;IAChB,OAAOX,KAAK,CAACW,KAAK;EACnB;;EAEA;EACA;EACA,IAAIX,KAAK,CAACmB,QAAQ,IAAInB,KAAK,CAACmB,QAAQ,CAACR,KAAK,EAAE;IAC3C,OAAOX,KAAK,CAACmB,QAAQ,CAACR,KAAK;EAC5B;AACD"}