{"version":3,"file":"ScrollManager.js","names":["STORAGE_NAMESPACE","ScrollContext","createContext","defaultCreateScrollBehavior","config","ScrollBehavior","ScrollManager","renderArgs","shouldUpdateScrollProperty","shouldUpdateScroll","createScrollBehavior","children","router","location","prevRenderArgs","useRef","scrollBehaviorRef","scrollBehavior","current","getCurrentLocation","useCallback","getCurrentLocationRef","call","registerScrollElement","key","element","registerElement","unregisterElement","scrollContext","useMemo","useEffect","addNavigationListener","stateStorage","StateStorage","stop","prevLocation","elements","error","updateScroll","React","createElement","Provider","value"],"sources":["../../../../lib/router/client/found-scroll/ScrollManager.js"],"sourcesContent":["// import StateStorage from '@catamphetamine/farce/StateStorage';\r\n// import StateStorage from '@catamphetamine/farce/lib/esm/StateStorage.js';\r\n// import StateStorage from '@catamphetamine/farce/lib/cjs/StateStorage.js';\r\nimport { StateStorage } from '@catamphetamine/farce';\r\nimport React, { useRef, useEffect, useMemo, useCallback, createContext } from 'react';\r\n// import ScrollBehavior from 'scroll-behavior';\r\nimport ScrollBehavior from '../scroll-behavior/index.js';\r\n\r\nconst STORAGE_NAMESPACE = '@@scroll';\r\n\r\nexport const ScrollContext = createContext(null);\r\n\r\nconst defaultCreateScrollBehavior = config => new ScrollBehavior(config);\r\n\r\n// Rewrote `<ScrollManager/>` from `found-scroll` in React hooks.\r\n// Also fixed React strict mode bug.\r\n// https://github.com/4Catalyzer/found-scroll/issues/382\r\nexport default function ScrollManager({\r\n  renderArgs,\r\n  shouldUpdateScroll: shouldUpdateScrollProperty,\r\n  createScrollBehavior = defaultCreateScrollBehavior,\r\n  children\r\n}) {\r\n  const { router, location } = renderArgs;\r\n\r\n  const prevRenderArgs = useRef(null);\r\n  const scrollBehaviorRef = useRef();\r\n\r\n  const scrollBehavior = scrollBehaviorRef.current;\r\n\r\n  const getCurrentLocation = useCallback(() => {\r\n    return location;\r\n  }, [location]);\r\n\r\n  const getCurrentLocationRef = useRef();\r\n  getCurrentLocationRef.current = getCurrentLocation;\r\n\r\n  const shouldUpdateScroll = useCallback((prevRenderArgs, renderArgs) => {\r\n    if (!shouldUpdateScrollProperty) {\r\n      return true;\r\n    }\r\n    // A hack to allow access to `ScrollBehavior` internals (e.g. `stateStorage`).\r\n    return shouldUpdateScrollProperty.call(scrollBehavior, prevRenderArgs, renderArgs);\r\n  }, [scrollBehavior]);\r\n\r\n  const registerScrollElement = useCallback((key, element) => {\r\n    scrollBehavior.registerElement(key, element, shouldUpdateScroll, renderArgs);\r\n    return () => {\r\n      scrollBehavior.unregisterElement(key);\r\n    };\r\n  }, [\r\n    shouldUpdateScroll,\r\n    scrollBehavior,\r\n    renderArgs\r\n  ]);\r\n\r\n  const scrollContext = useMemo(() => ({\r\n    scrollBehavior,\r\n    registerScrollElement\r\n  }), [\r\n    scrollBehavior,\r\n    registerScrollElement\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const scrollBehavior = createScrollBehavior({\r\n      addNavigationListener: router.addNavigationListener,\r\n      stateStorage: new StateStorage(router, STORAGE_NAMESPACE),\r\n      getCurrentLocation: () => getCurrentLocationRef.current(),\r\n      shouldUpdateScroll: (prevRenderArgs, renderArgs) => shouldUpdateScroll(prevRenderArgs, renderArgs)\r\n    });\r\n    scrollBehaviorRef.current = scrollBehavior;\r\n    return () => {\r\n      scrollBehavior.stop();\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const scrollBehavior = scrollBehaviorRef.current;\r\n    const prevLocation = prevRenderArgs.current && prevRenderArgs.current.location;\r\n\r\n    if (renderArgs.location === prevLocation || !(renderArgs.elements || renderArgs.error)) {\r\n      // If the location hasn't actually changed, or if we're in a global\r\n      // pending state, don't update the scroll position.\r\n      return;\r\n    }\r\n\r\n    scrollBehavior.updateScroll(prevRenderArgs.current, renderArgs);\r\n    prevRenderArgs.current = renderArgs;\r\n  });\r\n\r\n  // return (\r\n  //   <ScrollContext.Provider value={scrollContext}>\r\n  //     {children}\r\n  //   </ScrollContext.Provider>\r\n  // );\r\n\r\n  return React.createElement(ScrollContext.Provider, {\r\n    value: scrollContext\r\n  }, children);\r\n}"],"mappings":"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"}