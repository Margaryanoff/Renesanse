{"version":3,"file":"createRouterElement.js","names":["createRouterElement","renderArgs","dispatch","getState","ConnectedRouter","createConnectedRouter","render","elements","routes","window","reactPagesRemountOnNavigate","length","React","cloneElement","key","location","pathname","leafRouteElement","createElement","LeafRouteContext","Provider","value","firstNonRootRouteElementIndex","_isRootRoute_","firstNonRootRouteElement","NonRootRouteContext","RouteProvider","params","ScrollManager","matchContext","resolver","initialRenderArgs"],"sources":["../../../lib/router/client/createRouterElement.js"],"sourcesContent":["import React from 'react'\r\n\r\n// `@catamphetamine/found` is a fork of `found` with some changes:\r\n// * `redux` and `react-redux` are `peerDependencies` instead of `dependencies`.\r\n// * `farce` was replaced with `@catamphetamine/farce`.\r\n// * Fixed a bug when `found` ignores all navigation actions until its `componentDidMount()` is called.\r\nimport { createConnectedRouter, resolver } from '@catamphetamine/found'\r\n\r\n// It turned out that including a modified version of just `ScrollManager.js`\r\n// is simpler that maintaining a fork of `found-scroll`.\r\n// // `@catamphetamine/found-scroll` is a fork of `found-scroll` with some changes\r\n// // * `found` in `peerDependencies` instead of dependencies.\r\n// // * `found` replaced with `@catamphetamine/found`.\r\n// import { ScrollManager } from '@catamphetamine/found-scroll'\r\n\r\n// Rewrote `<ScrollManager/>` from `found-scroll` in React hooks.\r\n// Also fixed React strict mode bug.\r\n// https://github.com/4Catalyzer/found-scroll/issues/382\r\nimport ScrollManager from './found-scroll/ScrollManager.js'\r\n\r\nimport RouteProvider from '../RouteProvider.js'\r\n\r\nimport LeafRouteContext from '../LeafRouteContext.js'\r\nimport NonRootRouteContext from '../NonRootRouteContext.js'\r\n\r\nimport render from '../render.js'\r\n\r\nexport default function createRouterElement(renderArgs, { dispatch, getState }) {\r\n\tconst ConnectedRouter = createConnectedRouter({\r\n\t\trender: (renderArgs) => {\r\n\t\t\tconst { elements, routes } = renderArgs\r\n\r\n\t\t\t// Force re-mount the last route component on location path change.\r\n\t\t\t// https://github.com/4Catalyzer/found/issues/199#issuecomment-415616836\r\n\t\t\tif (elements && window.reactPagesRemountOnNavigate !== false) {\r\n\t\t\t\telements[elements.length - 1] = React.cloneElement(elements[elements.length - 1], { key: renderArgs.location.pathname })\r\n\t\t\t}\r\n\r\n\t\t\t// The route structure could specify a \"root\" route and all other routes that branch out from it,\r\n\t\t\t// ending with a \"leaf\" route that represents the page component.\r\n\t\t\t// * A \"root\" route can use `usePageStateSelectorOutsideOfPage()` hook.\r\n\t\t\t// * A \"leaf\" route should use `usePageStateSelector()` hook instead.\r\n\t\t\t// * A non-\"root\" and non-\"leaf\" route shouldn't really use either one.\r\n\t\t\tif (elements) {\r\n\t\t\t\t// Mark the \"leaf\" route as such.\r\n\t\t\t\tconst leafRouteElement = elements[elements.length - 1]\r\n\t\t\t\telements[elements.length - 1] = React.createElement(\r\n\t\t\t\t\tLeafRouteContext.Provider,\r\n\t\t\t\t\t{ value: true },\r\n\t\t\t\t\tleafRouteElement\r\n\t\t\t\t)\r\n\t\t\t\t// Mark any routes inside the \"root\" route as \"non-root\" ones.\r\n\t\t\t\tconst firstNonRootRouteElementIndex = renderArgs.routes[0]._isRootRoute_ ? 1 : 0\r\n\t\t\t\tconst firstNonRootRouteElement = elements[firstNonRootRouteElementIndex]\r\n\t\t\t\telements[firstNonRootRouteElementIndex] = React.createElement(\r\n\t\t\t\t\tNonRootRouteContext.Provider,\r\n\t\t\t\t\t{ value: true },\r\n\t\t\t\t\tfirstNonRootRouteElement\r\n\t\t\t\t)\r\n\t\t\t}\r\n\r\n\t\t\t// When a user navigates to a page, this `render()` function is called:\r\n\t\t\t// * If there's any `load()` data loader:\r\n\t\t\t//   * The first call is gonna be with `elements: undefined` and the new `location`,\r\n\t\t\t//     before the page starts loading the initial data.\r\n\t\t\t//     `<RouteProvider/>` ignores this `render()` call.\r\n\t\t\t//   * The second call is gonna be with `elements: React.Element[]` and the new `location`,\r\n\t\t\t//     after the page has loaded the initial data.\r\n\t\t\t// * Otherwise, if there's no data to load:\r\n\t\t\t//   * The page just renders with `elements: React.Element[]` and the new `location`.\r\n\t\t\treturn React.createElement(\r\n\t\t\t\tRouteProvider,\r\n\t\t\t\t{\r\n\t\t\t\t\t// `elements` is `undefined` when router starts loading the next page.\r\n\t\t\t\t\t// In that case, the previous page is still rendered, so it shouldn't\r\n\t\t\t\t\t// pass the new `location` to `<RouteProvider/>` yet.\r\n\t\t\t\t\tlocation: elements && renderArgs.location,\r\n\t\t\t\t\tparams: elements && renderArgs.params,\r\n\t\t\t\t\troutes: elements && renderArgs.routes\r\n\t\t\t\t},\r\n\t\t\t\tReact.createElement(\r\n\t\t\t\t\tScrollManager,\r\n\t\t\t\t\t{ renderArgs },\r\n\t\t\t\t\trender(renderArgs)\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t}\r\n\t})\r\n\treturn React.createElement(\r\n\t\tConnectedRouter,\r\n\t\t{\r\n\t\t\tmatchContext: {\r\n\t\t\t\tdispatch,\r\n\t\t\t\tgetState\r\n\t\t\t},\r\n\t\t\tresolver,\r\n\t\t\tinitialRenderArgs: renderArgs\r\n\t\t}\r\n\t)\r\n}"],"mappings":";;;;;;AAAA;AAMA;AAYA;AAEA;AAEA;AACA;AAEA;AAAiC;AAvBjC;AACA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAUe,SAASA,mBAAmB,CAACC,UAAU,QAA0B;EAAA,IAAtBC,QAAQ,QAARA,QAAQ;IAAEC,QAAQ,QAARA,QAAQ;EAC3E,IAAMC,eAAe,GAAG,IAAAC,4BAAqB,EAAC;IAC7CC,MAAM,EAAE,gBAACL,UAAU,EAAK;MACvB,IAAQM,QAAQ,GAAaN,UAAU,CAA/BM,QAAQ;QAAEC,MAAM,GAAKP,UAAU,CAArBO,MAAM;;MAExB;MACA;MACA,IAAID,QAAQ,IAAIE,MAAM,CAACC,2BAA2B,KAAK,KAAK,EAAE;QAC7DH,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC,GAAGC,iBAAK,CAACC,YAAY,CAACN,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC,EAAE;UAAEG,GAAG,EAAEb,UAAU,CAACc,QAAQ,CAACC;QAAS,CAAC,CAAC;MACzH;;MAEA;MACA;MACA;MACA;MACA;MACA,IAAIT,QAAQ,EAAE;QACb;QACA,IAAMU,gBAAgB,GAAGV,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC;QACtDJ,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC,GAAGC,iBAAK,CAACM,aAAa,CAClDC,4BAAgB,CAACC,QAAQ,EACzB;UAAEC,KAAK,EAAE;QAAK,CAAC,EACfJ,gBAAgB,CAChB;QACD;QACA,IAAMK,6BAA6B,GAAGrB,UAAU,CAACO,MAAM,CAAC,CAAC,CAAC,CAACe,aAAa,GAAG,CAAC,GAAG,CAAC;QAChF,IAAMC,wBAAwB,GAAGjB,QAAQ,CAACe,6BAA6B,CAAC;QACxEf,QAAQ,CAACe,6BAA6B,CAAC,GAAGV,iBAAK,CAACM,aAAa,CAC5DO,+BAAmB,CAACL,QAAQ,EAC5B;UAAEC,KAAK,EAAE;QAAK,CAAC,EACfG,wBAAwB,CACxB;MACF;;MAEA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,OAAOZ,iBAAK,CAACM,aAAa,CACzBQ,yBAAa,EACb;QACC;QACA;QACA;QACAX,QAAQ,EAAER,QAAQ,IAAIN,UAAU,CAACc,QAAQ;QACzCY,MAAM,EAAEpB,QAAQ,IAAIN,UAAU,CAAC0B,MAAM;QACrCnB,MAAM,EAAED,QAAQ,IAAIN,UAAU,CAACO;MAChC,CAAC,EACDI,iBAAK,CAACM,aAAa,CAClBU,yBAAa,EACb;QAAE3B,UAAU,EAAVA;MAAW,CAAC,EACd,IAAAK,mBAAM,EAACL,UAAU,CAAC,CAClB,CACD;IACF;EACD,CAAC,CAAC;EACF,OAAOW,iBAAK,CAACM,aAAa,CACzBd,eAAe,EACf;IACCyB,YAAY,EAAE;MACb3B,QAAQ,EAARA,QAAQ;MACRC,QAAQ,EAARA;IACD,CAAC;IACD2B,QAAQ,EAARA,eAAQ;IACRC,iBAAiB,EAAE9B;EACpB,CAAC,CACD;AACF"}