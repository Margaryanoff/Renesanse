{"version":3,"file":"Router.js","names":["Router","dispatch","getState","renderArgs","React","createElement","ConnectedRouter","matchContext","resolver","initialRenderArgs","createConnectedRouter","render","elements","routes","window","reactPagesRemountOnNavigate","length","cloneElement","key","getPageKey","location","leafRouteElement","LeafRouteContext","Provider","value","firstNonRootRouteElementIndex","_isRootRoute_","firstNonRootRouteElement","NonRootRouteContext","RouterContextValueProvider","params","ScrollManager","renderRouterElementContent"],"sources":["../../../lib/router/client/Router.js"],"sourcesContent":["import React from 'react'\r\n\r\n// `@catamphetamine/found` is a fork of `found` with some changes:\r\n// * `redux` and `react-redux` are `peerDependencies` instead of `dependencies`.\r\n// * `farce` was replaced with `@catamphetamine/farce`.\r\n// * Fixed a bug when `found` ignores all navigation actions until its `componentDidMount()` is called.\r\nimport { createConnectedRouter, resolver } from '@catamphetamine/found'\r\n\r\n// It turned out that including a modified version of just `ScrollManager.js`\r\n// is simpler that maintaining a fork of `found-scroll`.\r\n// // `@catamphetamine/found-scroll` is a fork of `found-scroll` with some changes\r\n// // * `found` in `peerDependencies` instead of dependencies.\r\n// // * `found` replaced with `@catamphetamine/found`.\r\n// import { ScrollManager } from '@catamphetamine/found-scroll'\r\n\r\n// Rewrote `<ScrollManager/>` from `found-scroll` in React hooks.\r\n// Also fixed React strict mode bug.\r\n// https://github.com/4Catalyzer/found-scroll/issues/382\r\nimport ScrollManager from './found-scroll/ScrollManager.js'\r\n\r\nimport RouterContextValueProvider from '../RouterContextValueProvider.js'\r\n\r\nimport LeafRouteContext from '../LeafRouteContext.js'\r\nimport NonRootRouteContext from '../NonRootRouteContext.js'\r\n\r\nimport renderRouterElementContent from '../renderRouterElementContent.js'\r\n\r\nimport { getPageKey } from '../../isSamePage.js'\r\n\r\nexport default function Router({ dispatch, getState, ...renderArgs }) {\r\n\treturn React.createElement(\r\n\t\tConnectedRouter,\r\n\t\t{\r\n\t\t\tmatchContext: {\r\n\t\t\t\tdispatch,\r\n\t\t\t\tgetState\r\n\t\t\t},\r\n\t\t\tresolver,\r\n\t\t\tinitialRenderArgs: renderArgs\r\n\t\t}\r\n\t)\r\n}\r\n\r\nconst ConnectedRouter = createConnectedRouter({\r\n\trender: (renderArgs) => {\r\n\t\tconst { elements, routes } = renderArgs\r\n\r\n\t\t// Force re-mount the last route component on location path change.\r\n\t\t// https://github.com/4Catalyzer/found/issues/199#issuecomment-415616836\r\n\t\tif (elements && window.reactPagesRemountOnNavigate !== false) {\r\n\t\t\telements[elements.length - 1] = React.cloneElement(elements[elements.length - 1], { key: getPageKey(renderArgs.location) })\r\n\t\t}\r\n\r\n\t\t// The route structure could specify a \"root\" route and all other routes that branch out from it,\r\n\t\t// ending with a \"leaf\" route that represents the page component.\r\n\t\t// * A \"root\" route can use `usePageStateSelectorOutsideOfPage()` hook.\r\n\t\t// * A \"leaf\" route should use `usePageStateSelector()` hook instead.\r\n\t\t// * A non-\"root\" and non-\"leaf\" route shouldn't really use either one.\r\n\t\tif (elements) {\r\n\t\t\t// Mark the \"leaf\" route as such.\r\n\t\t\tconst leafRouteElement = elements[elements.length - 1]\r\n\t\t\telements[elements.length - 1] = React.createElement(\r\n\t\t\t\tLeafRouteContext.Provider,\r\n\t\t\t\t{ value: true },\r\n\t\t\t\tleafRouteElement\r\n\t\t\t)\r\n\t\t\t// Mark any routes inside the \"root\" route as \"non-root\" ones.\r\n\t\t\tconst firstNonRootRouteElementIndex = renderArgs.routes[0]._isRootRoute_ ? 1 : 0\r\n\t\t\tconst firstNonRootRouteElement = elements[firstNonRootRouteElementIndex]\r\n\t\t\telements[firstNonRootRouteElementIndex] = React.createElement(\r\n\t\t\t\tNonRootRouteContext.Provider,\r\n\t\t\t\t{ value: true },\r\n\t\t\t\tfirstNonRootRouteElement\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\t// When a user navigates to a page, this `render()` function is called:\r\n\t\t// * If there's any `load()` data loader:\r\n\t\t//   * The first call is gonna be with `elements: undefined` and the new `location`,\r\n\t\t//     before the page starts loading the initial data.\r\n\t\t//     `<RouterContextValueProvider/>` ignores this `render()` call.\r\n\t\t//   * The second call is gonna be with `elements: React.Element[]` and the new `location`,\r\n\t\t//     after the page has loaded the initial data.\r\n\t\t// * Otherwise, if there's no data to load:\r\n\t\t//   * The page just renders with `elements: React.Element[]` and the new `location`.\r\n\t\treturn React.createElement(\r\n\t\t\tRouterContextValueProvider,\r\n\t\t\t{\r\n\t\t\t\t// `elements` is `undefined` when router starts loading the next page.\r\n\t\t\t\t// In that case, the previous page is still rendered, so it shouldn't\r\n\t\t\t\t// pass the new `location` to `<RouterContextValueProvider/>` yet.\r\n\t\t\t\tlocation: elements && renderArgs.location,\r\n\t\t\t\tparams: elements && renderArgs.params,\r\n\t\t\t\troutes: elements && renderArgs.routes\r\n\t\t\t},\r\n\t\t\tReact.createElement(\r\n\t\t\t\tScrollManager,\r\n\t\t\t\t{ renderArgs },\r\n\t\t\t\trenderRouterElementContent(renderArgs)\r\n\t\t\t)\r\n\t\t)\r\n\t}\r\n})"],"mappings":";;;;;;AAAA;AAMA;AAYA;AAEA;AAEA;AACA;AAEA;AAEA;AAAgD;AAAA;AAAA;AAAA;AAEjC,SAASA,MAAM,OAAwC;EAAA,IAArCC,QAAQ,QAARA,QAAQ;IAAEC,QAAQ,QAARA,QAAQ;IAAKC,UAAU;EACjE,OAAOC,iBAAK,CAACC,aAAa,CACzBC,eAAe,EACf;IACCC,YAAY,EAAE;MACbN,QAAQ,EAARA,QAAQ;MACRC,QAAQ,EAARA;IACD,CAAC;IACDM,QAAQ,EAARA,eAAQ;IACRC,iBAAiB,EAAEN;EACpB,CAAC,CACD;AACF;AAEA,IAAMG,eAAe,GAAG,IAAAI,4BAAqB,EAAC;EAC7CC,MAAM,EAAE,gBAACR,UAAU,EAAK;IACvB,IAAQS,QAAQ,GAAaT,UAAU,CAA/BS,QAAQ;MAAEC,MAAM,GAAKV,UAAU,CAArBU,MAAM;;IAExB;IACA;IACA,IAAID,QAAQ,IAAIE,MAAM,CAACC,2BAA2B,KAAK,KAAK,EAAE;MAC7DH,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC,GAAGZ,iBAAK,CAACa,YAAY,CAACL,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC,EAAE;QAAEE,GAAG,EAAE,IAAAC,sBAAU,EAAChB,UAAU,CAACiB,QAAQ;MAAE,CAAC,CAAC;IAC5H;;IAEA;IACA;IACA;IACA;IACA;IACA,IAAIR,QAAQ,EAAE;MACb;MACA,IAAMS,gBAAgB,GAAGT,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC;MACtDJ,QAAQ,CAACA,QAAQ,CAACI,MAAM,GAAG,CAAC,CAAC,GAAGZ,iBAAK,CAACC,aAAa,CAClDiB,4BAAgB,CAACC,QAAQ,EACzB;QAAEC,KAAK,EAAE;MAAK,CAAC,EACfH,gBAAgB,CAChB;MACD;MACA,IAAMI,6BAA6B,GAAGtB,UAAU,CAACU,MAAM,CAAC,CAAC,CAAC,CAACa,aAAa,GAAG,CAAC,GAAG,CAAC;MAChF,IAAMC,wBAAwB,GAAGf,QAAQ,CAACa,6BAA6B,CAAC;MACxEb,QAAQ,CAACa,6BAA6B,CAAC,GAAGrB,iBAAK,CAACC,aAAa,CAC5DuB,+BAAmB,CAACL,QAAQ,EAC5B;QAAEC,KAAK,EAAE;MAAK,CAAC,EACfG,wBAAwB,CACxB;IACF;;IAEA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,OAAOvB,iBAAK,CAACC,aAAa,CACzBwB,sCAA0B,EAC1B;MACC;MACA;MACA;MACAT,QAAQ,EAAER,QAAQ,IAAIT,UAAU,CAACiB,QAAQ;MACzCU,MAAM,EAAElB,QAAQ,IAAIT,UAAU,CAAC2B,MAAM;MACrCjB,MAAM,EAAED,QAAQ,IAAIT,UAAU,CAACU;IAChC,CAAC,EACDT,iBAAK,CAACC,aAAa,CAClB0B,yBAAa,EACb;MAAE5B,UAAU,EAAVA;IAAW,CAAC,EACd,IAAA6B,sCAA0B,EAAC7B,UAAU,CAAC,CACtC,CACD;EACF;AACD,CAAC,CAAC"}