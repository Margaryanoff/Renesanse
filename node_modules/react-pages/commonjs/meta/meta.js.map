{"version":3,"file":"meta.js","names":["browserDocument","BrowserDocument","BASE_META","charset","viewport","META_METHOD_NAME","mergeMeta","pageMeta","pageMetaData","rootMeta","rootMetaData","useSelector","stash","meta","dropUndefinedProperties","props","getRootComponentProps","setRootMeta","getPageComponentProps","setPageMeta","locale","locales","filter","_","length","updateMeta","document","title","normalizeMeta","metaTags","getMetaTags","getTitle","setTitle","updateMetaTag","newMetaTags","compact","map","key","value","forEach","removeMetaTag","addMetaTag","generateMetaTagsMarkup","escapeHTML","concat","generateMetaTagMarkup","name","String","getMetaAttributeFor","getMetaKeyAliases","i","meta_tag","isMetaTag","getMetaTagValue","setMetaTagValue","splice","string","replace","normalizeMetaKeys","Object","keys","reduce","all","alias","push","convertMeta","Array","isArray","flatten","keyValue","expandArrays","expandObjects","convertOpenGraphLocaleToLanguageTag","ogLocale"],"sources":["../../lib/meta/meta.js"],"sourcesContent":["// import { flatten, compact } from 'lodash-es'\r\nimport flatten from 'lodash/flatten.js'\r\nimport compact from 'lodash/compact.js'\r\n\r\nimport BrowserDocument, { getMetaAttributeFor } from './BrowserDocument.js'\r\nimport dropUndefinedProperties from './dropUndefinedProperties.js'\r\n\r\nconst browserDocument = new BrowserDocument()\r\n\r\nconst BASE_META = {\r\n\tcharset: 'utf-8',\r\n\t// Fixes CSS screen width on mobile devices.\r\n\t// Otherwise media queries would not be applied initially\r\n\t// and it would show desktop version design.\r\n\t// Also, for `/react-pages-base` page this meta tag\r\n\t// needs to be present in markup as the default one\r\n\t// because `/react-pages-base` page doesn't collect\r\n\t// meta from page components.\r\n\tviewport: 'width=device-width, initial-scale=1.0'\r\n}\r\n\r\nconst META_METHOD_NAME = 'meta'\r\n\r\n/**\r\n * Gathers `<title/>` and `<meta/>` tags (inside `<head/>`)\r\n * defined for this route (`components` array).\r\n * @param {object[]} meta — An array of meta objects.\r\n * @return {object}\r\n */\r\nexport function mergeMeta({\r\n\tpageMeta,\r\n\tpageMetaData,\r\n\trootMeta,\r\n\trootMetaData,\r\n\tuseSelector,\r\n\tstash\r\n}) {\r\n\t// // `Object.assign` is not supported in Internet Explorer.\r\n\t// meta = Object.assign({}, BASE_META, ...)\r\n\r\n\tmeta = { ...BASE_META }\r\n\r\n\tif (rootMeta) {\r\n\t\trootMetaData = dropUndefinedProperties(rootMeta({\r\n\t\t\tuseSelector,\r\n\t\t\tprops: stash.getRootComponentProps() || {}\r\n\t\t}))\r\n\t}\r\n\r\n\tstash.setRootMeta(rootMetaData)\r\n\tmeta = {\r\n\t\t...meta,\r\n\t\t...rootMetaData\r\n\t}\r\n\r\n\tif (pageMeta) {\r\n\t\tpageMetaData = dropUndefinedProperties(pageMeta({\r\n\t\t\tuseSelector,\r\n\t\t\tprops: stash.getPageComponentProps() || {}\r\n\t\t}))\r\n\t}\r\n\r\n\tstash.setPageMeta(pageMetaData)\r\n\tmeta = {\r\n\t\t...meta,\r\n\t\t...pageMetaData\r\n\t}\r\n\r\n\t// Remove `locale` from `locales`.\r\n\tif (meta.locale && meta.locales) {\r\n\t\tmeta.locales = meta.locales.filter(_ => _ !== meta.locale)\r\n\t\tif (meta.locales.length === 0) {\r\n\t\t\tdelete meta.locales\r\n\t\t}\r\n\t}\r\n\r\n\treturn meta\r\n}\r\n\r\n// Instead of the old `patchMeta()` (exported as `updateMeta()`) function,\r\n// developers could see if the new automatically-updated `.meta()`\r\n// with `useSelector` parameter works.\r\n/**\r\n * (advanced) (hacking around)\r\n * This client-side-only function is expored from this library\r\n * as an `updateMeta()` function. It could be used to \"patch\"\r\n * the latest applied `meta` for whatever reason.\r\n *\r\n * For example, one project required this type of function when\r\n * migrating `load()` methods from always being handled by this library\r\n * to being sometimes handled in a React's `useEffect()` hook\r\n * as a possible \"user experience\" enhancement.\r\n *\r\n * Another use case would be somehow changing the page's `title`\r\n * after some additional user-specific data has been loaded in a\r\n * React's `useEffect()` hook.\r\n *\r\n * Or, for example, when `<title/>` gets updated with the count of\r\n * unread notifications.\r\n */\r\n// export function patchMeta(metaProperties) {\r\n// \tupdateMeta({\r\n// \t\t...window._ReactPages_Page_Meta,\r\n// \t\t...metaProperties\r\n// \t})\r\n// }\r\n\r\n/**\r\n * Updates `<title/>` and `<meta/>` tags (inside `<head/>`).\r\n */\r\nexport function updateMeta(meta, document = browserDocument) {\r\n\t// `patchMeta()` function is not exported in the new version of this library.\r\n\t// // Keep a reference to the latest applied `meta`\r\n\t// // in order for the `patchMeta()` public exported function to work.\r\n\t// // The public exported `patchMeta()` function is not the same as\r\n\t// // this `updateMeta()` function.\r\n\t// //\r\n\t// // Tests don't have a `window` global variable.\r\n\t// if (typeof window !== 'undefined') {\r\n\t// \twindow._ReactPages_Page_Meta = meta\r\n\t// }\r\n\r\n\tconst { title, charset } = meta\r\n\tmeta = normalizeMeta(meta)\r\n\r\n\t// Get all `<meta/>` tags.\r\n\t// (will be mutated)\r\n\tconst metaTags = document.getMetaTags()\r\n\r\n\t// Update `<title/>`.\r\n\tif (title && document.getTitle() !== title) {\r\n\t\tdocument.setTitle(title)\r\n\t}\r\n\r\n\t// Update `<meta charset/>`.\r\n\tif (charset) {\r\n\t\tupdateMetaTag(document, metaTags, 'charset', charset)\r\n\t}\r\n\r\n\t// Update existing `<meta/>` tags.\r\n\t// (removing them from `metaTags` array)\r\n\tconst newMetaTags = compact(\r\n\t\tmeta.map(([key, value]) => {\r\n\t\t\tif (!updateMetaTag(document, metaTags, key, value)) {\r\n\t\t\t\treturn [key, value]\r\n\t\t\t}\r\n\t\t})\r\n\t)\r\n\r\n\t// Delete no longer existent `<meta/>` tags.\r\n\tmetaTags.forEach(document.removeMetaTag)\r\n\r\n\t// Create new `<meta/>` tags.\r\n\tfor (const [key, value] of newMetaTags) {\r\n\t\tdocument.addMetaTag(key, value)\r\n\t}\r\n}\r\n\r\n/**\r\n * Generates a list of `<title/>` and `<meta/>` tags markup.\r\n * @param  {object[]} meta\r\n * @return {string[]}\r\n */\r\nexport function generateMetaTagsMarkup(meta) {\r\n\tconst { title, charset } = meta\r\n\tmeta = normalizeMeta(meta)\r\n\r\n\treturn [\r\n\t\t// `<meta charset/>` should always come first\r\n\t\t// because some browsers only read the first\r\n\t\t// 1024 bytes when deciding on page encoding.\r\n\t\t// (`<meta charset/>` is always present)\r\n\t\t`<meta charset=\"${escapeHTML(charset || BASE_META.charset)}\"/>`,\r\n\t\t`<title>${escapeHTML(title || '')}</title>`\r\n\t]\r\n\t.concat(\r\n\t\tmeta.map(([key, value]) => generateMetaTagMarkup(key, value))\r\n\t)\r\n}\r\n\r\n/**\r\n * Generates `<meta/>` tag HTML markup.\r\n * @param {string} key\r\n * @param {string} value\r\n * @return {string}\r\n */\r\nfunction generateMetaTagMarkup(name, value) {\r\n\tif (typeof value === 'boolean' || typeof value === 'number') {\r\n\t\tvalue = String(value)\r\n\t} else {\r\n\t\tvalue = escapeHTML(String(value))\r\n\t}\r\n\treturn `<meta ${getMetaAttributeFor(name)}=\"${name}\" content=\"${value}\"/>`\r\n}\r\n\r\n/**\r\n * Gets `<meta/>` property aliases.\r\n * (for both `name` and `property`).\r\n * Also filters out `charset`.\r\n * @return {string}\r\n */\r\nfunction getMetaKeyAliases(key) {\r\n\tswitch (key)\r\n\t{\r\n\t\t// `<meta charset/>` is handled specially\r\n\t\t// because it doesn't have `name` attribute.\r\n\t\tcase 'charset':\r\n\t\t\treturn []\r\n\t\t// `<meta name=\"description\"/>` is an older and\r\n\t\t// more widely supported form than \"og:description\".\r\n\t\t// In practice there's no need to duplicate\r\n\t\t// `<meta name=\"description\"/>` as \"og:description\".\r\n\t\t// Still, to keep it fully-OpenGraph-compliant\r\n\t\t// the description is duplicated as \"og:description\" here.\r\n\t\t// https://indieweb.org/The-Open-Graph-protocol#How_to_set_description\r\n\t\tcase 'description':\r\n\t\t\treturn [key, `og:${key}`]\r\n\t\tcase 'siteName':\r\n\t\t\treturn [`og:site_name`]\r\n\t\tcase 'site_name':\r\n\t\t// `title` property of `meta` object is\r\n\t\t// handled specially via a `<title/>` tag.\r\n\t\t// There would be no need to add `og:title`\r\n\t\t// which duplicates the existing `<title/>`,\r\n\t\t// and `title` property could be discarded here.\r\n\t\t// For example, Facebook falls back to `<title/>` tag.\r\n\t\t// Still, OpenGraph specs formally require an `og:title`.\r\n\t\t// So, to keep it fully-OpenGraph-compliant\r\n\t\t// the title is duplicated as \"og:title\" here.\r\n\t\t// https://indieweb.org/The-Open-Graph-protocol#How_to_set_title\r\n\t\tcase 'title':\r\n\t\t// SVG images are not supported (boo).\r\n\t\t// https://indieweb.org/The-Open-Graph-protocol#How_to_set_image\r\n\t\tcase 'image':\r\n\t\tcase 'locale':\r\n\t\tcase 'type':\r\n\t\tcase 'url':\r\n\t\tcase 'audio':\r\n\t\tcase 'video':\r\n\t\t\treturn [`og:${key}`]\r\n\t\tcase 'locales':\r\n\t\t\treturn ['og:locale:alternate']\r\n\t\tdefault:\r\n\t\t\treturn [escapeHTML(key)]\r\n\t}\r\n}\r\n\r\n/**\r\n * Updates `<meta/>` tag to a new `value` and removes it from `metaTags`.\r\n * @param {Document} document - `BrowserDocument` or `TestDocument`.\r\n * @return {boolean?}\r\n */\r\nfunction updateMetaTag(document, metaTags, name, value) {\r\n\tlet i = 0\r\n\twhile (i < metaTags.length) {\r\n\t\tconst meta_tag = metaTags[i]\r\n\t\tif (document.isMetaTag(meta_tag, name)) {\r\n\t\t\t// Update `<meta/>` tag `value`.\r\n\t\t\tif (document.getMetaTagValue(meta_tag) !== value) {\r\n\t\t\t\tdocument.setMetaTagValue(meta_tag, value)\r\n\t\t\t}\r\n\t\t\t// Remove it from `metaTags`.\r\n\t\t\tmetaTags.splice(i, 1)\r\n\t\t\t// Updated.\r\n\t\t\treturn true\r\n\t\t}\r\n\t\ti++\r\n\t}\r\n}\r\n\r\n/**\r\n * Escapes a string so that it's kinda safe to insert into HTML.\r\n * @return {string}\r\n */\r\nfunction escapeHTML(string) {\r\n\treturn string && string\r\n\t\t.replace('&', '&amp;')\r\n\t\t.replace('<', '&lt;')\r\n\t\t.replace('>', '&gt;')\r\n\t\t.replace('\"', '&quot;')\r\n\t\t.replace('\\'', '&#x27;')\r\n\t\t.replace('/', '&#x2F;')\r\n}\r\n\r\n/**\r\n * Transforms meta object having \"keys\"\r\n * into a meta object having the actual\r\n * `<meta/>` tag `name`s and `property`es.\r\n * @return Array of arrays having shape `[key, value]`.\r\n */\r\nfunction normalizeMetaKeys(meta) {\r\n\treturn Object.keys(meta).reduce((all, key) => {\r\n\t\tfor (const alias of getMetaKeyAliases(key)) {\r\n\t\t\tall.push([alias, meta[key]])\r\n\t\t}\r\n\t\treturn all\r\n\t}, [])\r\n}\r\n\r\nfunction normalizeMeta(meta) {\r\n\treturn convertMeta(normalizeMetaKeys(meta))\r\n}\r\n\r\n// Expands nested objects.\r\n// Expands arrays.\r\n// @param meta — Either an object or an array of arrays having shape `[key, value]`.\r\n// @return An array of arrays having shape `[key, value]`.\r\nexport function convertMeta(meta) {\r\n\t// Convert meta object to an array of arrays having shape `[key, value]`.\r\n\tif (!Array.isArray(meta)) {\r\n\t\tmeta = Object.keys(meta).map(key => [key, meta[key]])\r\n\t}\r\n\treturn flatten(\r\n\t\tmeta.map((keyValue) => {\r\n\t\t\treturn flatten(\r\n\t\t\t\texpandArrays(keyValue)\r\n\t\t\t\t\t.map(expandObjects)\r\n\t\t\t)\r\n\t\t})\r\n\t)\r\n}\r\n\r\n// There can be arrays of properties.\r\n// For example:\r\n// <meta property=\"og:image\" content=\"//example.com/image.jpg\" />\r\n// <meta property=\"og:image:width\" content=\"100\" />\r\n// <meta property=\"og:image:height\" content=\"100\" />\r\n// <meta property=\"og:image\" content=\"//example.com/image@2x.jpg\" />\r\n// <meta property=\"og:image:width\" content=\"200\" />\r\n// <meta property=\"og:image:height\" content=\"200\" />\r\nexport function expandArrays(meta) {\r\n\tif (Array.isArray(meta[1])) {\r\n\t\treturn meta[1].map(value => [meta[0], value])\r\n\t}\r\n\treturn [meta]\r\n}\r\n\r\n// If `value` is an object\r\n// then expand such object\r\n// prefixing property names.\r\nexport function expandObjects(meta) {\r\n\tif (typeof meta[1] === 'object') {\r\n\t\treturn flatten(\r\n\t\t\tObject.keys(meta[1])\r\n\t\t\t\t.map((key) => [\r\n\t\t\t\t\tkey === '_' ? meta[0] : `${meta[0]}:${key}`,\r\n\t\t\t\t\tmeta[1][key]\r\n\t\t\t\t])\r\n\t\t\t\t// Expand objects recursively.\r\n\t\t\t\t.map(expandObjects)\r\n\t\t)\r\n\t}\r\n\treturn [meta]\r\n}\r\n\r\nexport function convertOpenGraphLocaleToLanguageTag(ogLocale) {\r\n\treturn ogLocale.replace('_', '-')\r\n}"],"mappings":"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"}