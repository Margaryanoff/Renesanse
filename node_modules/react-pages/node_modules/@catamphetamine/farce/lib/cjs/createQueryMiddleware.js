"use strict";

exports.__esModule = true;
exports.default = createQueryMiddleware;

var _createLocationMiddleware = _interopRequireDefault(require("./createLocationMiddleware"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createQueryMiddleware({
  parse,
  stringify
}) {
  return (0, _createLocationMiddleware.default)({
    makeLocationDescriptor(location) {
      const {
        query
      } = location;

      if (query === undefined) {
        return location;
      }

      const queryString = stringify(query);
      const search = queryString ? `?${queryString}` : '';
      return Object.assign({}, location, {
        search
      });
    },

    makeLocation(location) {
      if (location.query !== undefined) {
        return location;
      }

      let query;

      try {
        query = parse(location.search.slice(1));
      } catch (e) {
        query = null;
      }

      return Object.assign({}, location, {
        query
      });
    }

  });
}

module.exports = exports.default;